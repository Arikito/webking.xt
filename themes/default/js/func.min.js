/*! xt.ua 2017-02-13 */
function GetLocation(){var a;return navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.Geocoder,c={lat:a.coords.latitude,lng:a.coords.longitude};b.geocode({location:c},function(a,b){b===google.maps.GeocoderStatus.OK?a[2]?$(".mainUserInf .userlocation").html(a[2].formatted_address):$(".mainUserInf .userlocation").html(a[6].formatted_address):$(".mainUserInf .userlocation").addClass("hidden")})}),a}function GetCartAjax(){$("#cart > .modal_container").html(""),ajax("cart","GetCartPage",!1,"html").done(function(a){$("#cart > .modal_container").html(a),removeLoadAnimation("#cart"),Position($("#cart"))})}function GetQuizAjax(a){data={step:void 0===a.step?1:a.step},void 0!==a.id_user&&(data.id_user=a.id_user),void 0!==a.target_id_order&&(data.target_id_order=a.target_id_order),ajax("quiz","step",data,"html").done(function(a){$("#quiz").html(a),componentHandler.upgradeDom(),removeLoadAnimation("#quiz"),Position($("#quiz"))})}function GetGiftSelectAjax(){$("#gift_select > .modal_container").html(""),ajax("cart","giftSelect",!1,"html").done(function(a){$("#gift_select > .modal_container").html(a),removeLoadAnimation("#gift_select"),Position($("#gift_select"))})}function GetCabProdAjax(a,b){$(".content").addClass("loading"),ajax("cabinet","GetProdList",{id_order:a,rewrite:b},"html").done(function(a){$(".mdl-tabs__panel > #products").html(a),$(".content").removeClass("loading")})}function GetCabCoopProdAjax(a,b){ajax("cabinet","GetProdListForJO",{id_cart:a,rewrite:b},"html").done(function(a){$('a[href^="#items_panel_"]').hasClass("getCabCoopProdAjax_js")?$(".products_cart_js").html(a):($(".active_link_to_cart_js").closest("li").find(".products_cart_js").html(a),$(".list_in_cart_js").removeClass("active_link_to_cart_js"))})}function ModalDemandChart(a){ajax("product","OpenModalDemandChart",{id_category:a},"html").done(function(a){$("#demand_chart .modal_container").html(a),componentHandler.upgradeDom(),openObject("demand_chart")})}function ajax(a,b,c,d,e){e?(c.append("target",a),c.append("action",b)):"object"==typeof c?(c.target=a,c.action=b):c={target:a,action:b},d=d||"json";var f=$.ajax({url:URL_base+"ajax",beforeSend:function(a){ajax_proceed===!0,ajax_proceed=!0},type:"POST",dataType:d,data:c,processData:!e,contentType:!e&&"application/x-www-form-urlencoded; charset=UTF-8"}).always(function(){ajax_proceed=!1});return f}function resizeAsideScroll(a){var b=$(window).height(),c=$(".main").height(),d=$(".main_nav").outerHeight(),e=$(this).scrollTop(),f=e+b-c-52+d;return e+b>CurentMainWindow+52?($("aside .catalog .second_nav").css("max-height","calc(100vh - 52px - "+f+"px"),$("aside .filters_container").css("max-height","calc(100vh - 52px - "+(f+43)+"px")):($("aside .catalog .second_nav").css("max-height","calc(100vh - "+(d+52)+"px"),$("aside .filters_container").css("max-height","calc(100vh - "+(d+52+43)+"px")),!0}function ChangeView(a){switch(a){case"list":$("#view_block_js").removeClass().addClass("list_view col-md-12 ajax_loading");break;case"block":$("#view_block_js").removeClass().addClass("block_view col-md-12 ajax_loading");break;case"column":$("#view_block_js").removeClass().addClass("column_view col-md-12 ajax_loading")}document.cookie="product_view="+a+"; path=/"}function ListenPhotoHover(){preview=$(".list_view .preview"),previewOwl=preview.find("#owl-product_slide_js"),$("body").on("mouseover",".list_view .product_photo:not(hovered)",function(){$(this).not(".hovered")&&(showPreview(!1),$(this).addClass("hovered"),rebuildPreview($(this)))}).on("mouseleave",".list_view .product_photo:not(hovered)",function(a){if($("#view_block_js").hasClass("list_view")){var b=mousePos(a),c=$(this);c.hasClass("hovered")&&(b.x<=c.offset().left||b.x>=c.offset().left+c.width()||b.y<=c.offset().top||b.y>=c.offset().top+c.height())&&(hidePreview(),c.removeClass("hovered"))}}),preview.on("mouseleave",function(a){$("#view_block_js").hasClass("list_view")&&(mp=mousePos(a),obj=$(".product_photo.hovered"),obj.hasClass("hovered")&&(mp.x<=obj.offset().left||mp.x>=obj.offset().left+obj.width()||mp.y<=obj.offset().top||mp.y>=obj.offset().top+obj.height())&&(hidePreview(),obj.removeClass("hovered")))})}function hidePreview(){preview.hide().addClass("ajax_loading"),previewOwl.data("owlCarousel")&&previewOwl.data("owlCarousel").destroy()}function rebuildPreview(a){var b=a.offset(),c=$("#view_block_js").offset(),d=a.closest(".card").data("idproduct"),e=($(window).width(),$(window).height()),f=getScrollWindow(),g=0,h=0,i=15,j=i+$("header").outerHeight(),k=b.top-preview.height()/2+a.outerHeight()/2-j,l=b.top+preview.height()/2+a.outerHeight()/2+i;f+e<l?g=l-(f+e):f>k&&(h=k-f),preview.css({top:b.top-c.top-preview.height()/2+a.height()/2-g-h,left:80}),b.top-preview.offset().top+a.height()/2+preview.find(".triangle").height()>preview.height()?preview.css("border-radius","5px 5px 5px 0").find(".triangle").css({top:"50%",left:20}):preview.offset().top>b.top+a.height()/2-preview.find(".triangle").height()?preview.css("border-radius","0 5px 5px 5px").find(".triangle").css({top:"50%",left:20}):preview.css("border-radius","5px").find(".triangle").css({top:b.top-preview.offset().top+a.height()/2,left:-7}),a.hasClass("hovered")?ajax("product","GetPreview",{id_product:d},"html").done(function(a){preview.find(".preview_content").html(a),componentHandler.upgradeDom(),showPreview(!0)}):preview.hide()}function getScrollWindow(){var a=document.documentElement,b=document.body,c=a.scrollTop||b&&b.scrollTop||0;return c-=a.clientTop}function changeToTop(a){var b=$("#toTop");a>$("html").height()/8?b.hasClass("visible")===!1&&b.addClass("visible"):b.hasClass("visible")&&b.removeClass("visible")}function showPreview(a){a?preview.removeClass("ajax_loading").find("#owl-product_slide_js").owlCarousel({center:!0,dots:!0,items:1,margin:20,nav:!0,video:!0,videoHeight:300,videoWidth:300,navText:['<svg class="arrow_left"><use xlink:href="images/slider_arrows.svg#arrow_left_tidy"></use></svg>','<svg class="arrow_right"><use xlink:href="images/slider_arrows.svg#arrow_right_tidy"></use></svg>']}):preview.show()}function mousePos(a){var b=a.pageX,c=a.pageY;return{x:b,y:c}}function ChangePriceRange(a,b){var c=a==$.cookie("sum_range"),d="";if(1==b){if($.cookie("sum_range",a,{path:"/"}),$.cookie("manual",1,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+a).addClass("active"),a==$.cookie("sum_range")){switch(a){case 3:d="Без скидки!";break;case 2:d="При заказе от "+columnLimits[2]+" грн.";break;case 1:d="При заказе от "+columnLimits[1]+" грн.";break;case 0:d="При заказе от "+columnLimits[0]+" грн."}$(".order_balance").text(d)}}else 1!=$.cookie("manual")?($.cookie("sum_range",a,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+a).addClass("active"),a=a>0?a-1:0):a=$.cookie("sum_range");addLoadAnimation(".order_balance"),addLoadAnimation("#button-cart1"),ajax("cart","GetCart").done(function(b){if(removeLoadAnimation(".order_balance"),removeLoadAnimation("#button-cart1"),currentSum=b.products_sum[3],newSum=columnLimits[a]-currentSum,1!=$.cookie("manual")){switch(b.cart_column){case 3:d="Без скидки!";break;case 2:d="При заказе от "+columnLimits[2]+" грн.";break;case 1:d="При заказе от "+columnLimits[1]+" грн.";break;case 0:d="При заказе от "+columnLimits[0]+" грн."}$(".order_balance").text(d)}if($(".product_buy").each(function(){var a=parseInt($(this).find(".minQty").val()),b=parseInt($(this).find(".qty_js").val()),c=parseFloat($(this).find(".price"+(b>=a?"Opt":"Mopt")+$.cookie("sum_range")).val()).toFixed(2).toString().replace(".",","),d=$(this).find(".basePrice"+(b>=a?"Opt":"Mopt")+$.cookie("sum_range")).val();b>=a?$(this).find(".priceMoptInf").addClass("hidden"):$(this).find(".priceMoptInf").removeClass("hidden"),$(this).find(".price").html(c),$(this).find(".base_price").html(d)}),c===!0&&setTimeout(function(){$(".product_buy .product_price *").stop(!0,!0).css({color:"#FF5722"}).delay(1e3).animate({color:"#444444"},3e3)},300),$("#cart").hasClass("opened")){var e=parseInt($("#cart .cart_buttons .min_sum_order").val()),f=parseInt($("#cart .cart_buttons .current_user").val());b.products_sum[3]<e&&4!=f?($("#button-cart1 button").addClass("hidden"),$("#button-cart1 p").removeClass("hidden")):($("#button-cart1 button").removeClass("hidden"),$("#button-cart1 p").addClass("hidden"))}})}function openObject(a,b){switch(a){case"gift_select":GetGiftSelectAjax(b);break;case"cart":GetCartAjax(b);break;case"quiz":void 0===b&&(b={reload:!1}),GetQuizAjax(b)}if(void 0===b||b.reload!==!0){var c=$("#"+a),d=c.data("type");$("html").hasClass("active_bg")&&$('.opened:not([id="'+c.attr("id")+'"])').each(function(a,b){closeObject($(this).attr("id"))}),c.hasClass("opened")&&"search"!=d?(closeObject(c.attr("id")),DeactivateBG()):("cart"==a&&addLoadAnimation("#"+a),"phone_menu"==a&&$('[data-name="phone_menu"] i').text("close"),"modal"==d?(c.find(".modal_container").css({"max-height":.8*$(window)}),Position(c.addClass("opened"))):c.addClass("opened"),ActivateBG())}}function closeObject(a){void 0===a?$(".opened").each(function(a,b){closeObject($(this).attr("id"))}):($("#"+a).removeClass("opened"),"phone_menu"==a&&$('[data-name="phone_menu"] i').text("menu")),DeactivateBG()}function Position(a){a.css({top:($(window).height()+52-a.outerHeight())/2,left:($(window).width()-a.outerWidth())/2})}function ActivateBG(){$("html").addClass("active_bg")}function DeactivateBG(){$("html").removeClass("active_bg")}function closePanel(){$(".menu").html("menu"),$(".panel").slideUp()}function changestars(a){$(".set_rating").each(function(){$(this).next("i").text(parseInt($(this).val())<=parseInt(a)?"star":"star_border")})}function ValidatePass(a,b){var c,d=0,e=b.closest(".forPassStrengthContainer_js"),f=new RegExp("^(?=.*[a-zа-я]).*$","g");f.test(a)&&d++;var g=new RegExp("^(?=.*[A-ZА-Я]).*$","g");g.test(a)&&d++;var h=new RegExp("^(?=.*[0-9]).*$","g");h.test(a)&&d++;var i=new RegExp("^(?=.*[!,@,#,$,%,^,&,*,?,_,~,-,=]).*$","g");return i.test(a)&&d++,1==d&&($("#passwd + .mdl-textfield__error").empty(),e.find(".ps_lvl_js").addClass("bad").removeClass("better").removeClass("ok").removeClass("best"),c=!1),2==d&&(e.find(".ps_lvl_js").addClass("better").removeClass("ok").removeClass("best"),c=!1),3==d&&(e.find(".ps_lvl_js").addClass("ok").removeClass("best"),c=!1),4==d&&(e.find(".ps_lvl_js").addClass("best"),c=!1),a.length<1?($("#passwd + .mdl-textfield__error").empty(),e.find(".ps_lvl_js").removeClass("bad").removeClass("better").removeClass("ok").removeClass("best"),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").find(".mdl-textfield__error").text("Введите пароль")):a.length>=1&&a.length<4&&($("#passwd + .mdl-textfield__error").empty(),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароль слишком короткий")),c}function ValidatePassConfirm(a,b){return b===a&&b?($('[name="passwdconfirm"]').closest(".mdl-textfield").removeClass("is-invalid").find(".mdl-textfield__error").text("Пароли совпали").css({visibility:"visible",color:"#018b06"}),$('[name="passwdconfirm"]').val().length>=4&&$(".verification_btn").removeAttr("disabled"),!1):($('[name="passwdconfirm"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароли не совпадают").css({visibility:"visible",color:"#D50000"}),void $(".verification_btn").attr("disabled","disabled"))}function ValidateEmail(a,b){ajax("auth","register",a).done(function(a){return removeLoadAnimation("#registration"),a})}function ValidateName(a){return a.length<3?($("#name ~ .mdl-textfield__error").empty(),$("#name").closest(".mdl-textfield ").addClass("is-invalid"),0===a.length?$("#name ~ .mdl-textfield__error").append("Введите имя"):$("#name ~ .mdl-textfield__error").append("Имя слишком короткое"),void 0):($("#name ~ .mdl-textfield__error").empty(),!1)}function CompleteValidation(a,b,c,d){var e=0,f=!1;return f=ValidateName(a),f&&($("#regs .mdl-textfield__error").closest("#name .mdl-textfield").text(f),e++),b&&($("#regs .mdl-textfield__error").closest("#email .mdl-textfield").text(b),e++),f=ValidatePass(c),f&&($("#regs .mdl-textfield__error").closest("#passwd .mdl-textfield").text(f),e++),f=ValidatePassConfirm(c,d),f&&($("#regs .mdl-textfield__error").closest("#passwdconfirm .mdl-textfield").text(f),e++),!(e>0)}function moveObjects(){var a=$('div:not(.modals) [data-type="modal"]');a.each(function(a,b){$(".modals").append(b)});var b=$('div:not(.panels) [data-type="panel"]');b.each(function(a,b){$(".panels").append(b)})}function DelFromAssort(a){var b=a.closest(".products_list_item").data("id-product");ajax("product","DelFromAssort",{id_product:b}).done(function(){a.closest(".products_list_item").slideUp()})}function toAssort(a,b,c,d){var e=$(".inusd"+a).prop("checked"),f=($("#currency_rate").val(),1==b?"opt":"mopt"),g=parseFloat($("#price_"+f+"_otpusk_"+a).val().replace(",",".")),h=(parseFloat($("#price_"+f+"_otpusk_"+a).val().replace(",",".")),parseFloat($("#product_limit_mopt_"+a).val()),0);$("#balance_info-"+a+" input").is(":checked")&&(h=1),ajax("supplier","updateAssort",{mode:f,id_product:a,price:g,active:h,comment:d,inusd:e===!1?0:1})}function AddDelProductAssortiment(a,b){ajax("product",a.checked?"AddToAssort":"DelFromAssort",{id_product:b})}function setCookie(a,b){var c=escape(b),d=new Date;if(c.length<=4e3){d.setTime(d.getTime()+31536e6);var e=d.toGMTString();document.cookie=a+"="+c+"; path=/; expires="+e+";"}}function getCookie(a){var b=a+"=",c=document.cookie.indexOf(b);if(c==-1)return null;var d=document.cookie.indexOf(";",c+b.length);return d==-1&&(d=document.cookie.length),unescape(document.cookie.substring(c+b.length,d))}function addLoadAnimation(a){"object"==typeof a&&0===a.has(".loadBlock").length?a.append('<div class="loadBlock"><div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active loadAnimation"></div></div>'):0===$(a).has(".loadBlock").length&&$(a).append('<div class="loadBlock"><div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active loadAnimation"></div></div>'),componentHandler.upgradeDom()}function removeLoadAnimation(a){"object"==typeof a&&a.has(".loadBlock").length>0?a.find(".loadBlock").remove():$(a).has(".loadBlock").length>0&&$(a).find(".loadBlock").remove(),componentHandler.upgradeDom()}function AddFavorite(a,b,c){return console.log(c),console.log(b),ajax("product","add_favorite",{id_product:a}).done(function(a){var d={};"login"==a.answer?(openObject("auth"),removeLoadAnimation("#auth")):"already"==a.answer?d={message:"Товар уже находится в избранном"}:"ok"==a.answer?($(".userChoiceFav").text("("+a.fav_count+")"),d={message:"Товар добавлен в избранное"},c?(b.find(".favorite_js").empty().text("favorite").removeClass("notfavorite").addClass("isfavorite"),b.find("span").empty().text("В избранном")):(b.empty().text("favorite").removeClass("notfavorite").addClass("isfavorite"),b.next().empty().html("Товар уже <br> в избранном"))):"wrong user group"==a.answer&&(d={message:"Данный функционал доступен только для клиентов"});var e=document.querySelector("#snackbar");e.MaterialSnackbar.showSnackbar(d)}).fail(function(a){alert("Error")}),!1}function RemoveFavorite(a,b,c){return ajax("product","del_favorite",{id_product:a}).done(function(a){var d={};"login"==a.answer?(openObject("auth"),removeLoadAnimation("#auth")):"ok"==a.answer?($(".userChoiceFav").text("("+a.fav_count+")"),d={message:"Товар удален из избранного"},c?(b.find(".favorite_js").empty().text("favorite_border").addClass("notfavorite").removeClass("isfavorite"),b.find("span").empty().text("В избранное")):(b.empty().text("favorite_border").addClass("notfavorite").removeClass("isfavorite"),b.next().empty().html("Добавить товар <br> в избранное"))):"wrong user group"==a.answer&&(d={message:"Данный функционал доступен только для клиентов"});var e=document.querySelector("#snackbar");e.MaterialSnackbar.showSnackbar(d)}).fail(function(a){alert("Error")}),!1}function AddInWaitingList(a,b,c,d){var e={id_product:a,id_user:b,email:c};return ajax("product","add_in_waitinglist",e).done(function(a){var b={};"login"==a.answer?(openObject("auth"),removeLoadAnimation("#auth")):"already"==a.answer?b={message:"Товар уже в списке ожидания"}:"ok"==a.answer?($(".userChoiceWait").text("("+a.fav_count+")"),b={message:"Товар добавлен в список ожидания"},d.addClass("arrow"),d.closest(".fortrending").find(".mdl-tooltip").html("Товар в <br> списке ожидания"),$("#specCont").find(".fortrending_info_tooltip").html("Товар в <br> списке ожидания")):"wrong user group"==a.answer&&(b={message:"Данный функционал доступен только для клиентов"});var c=document.querySelector("#snackbar");c.MaterialSnackbar.showSnackbar(b)}).fail(function(a){var b={message:"Данный функционал доступен только для клиентов"},c=document.querySelector("#snackbar");c.MaterialSnackbar.showSnackbar(b)}),!1}function RemoveFromWaitingList(a,b,c,d){var e={id_product:a,id_user:b,email:c};return ajax("product","del_from_waitinglist",e).done(function(a){var b={};"login"==a.answer?(openObject("auth"),removeLoadAnimation("#auth")):"ok"==a.answer?($(".userChoiceWait").text("("+a.fav_count+")"),b={message:"Товар удален из списка ожидания"},d.removeClass("arrow"),d.closest(".fortrending").find(".mdl-tooltip").html("Следить за ценой"),$("#specCont").find(".fortrending_info_tooltip").html("Следить за ценой")):"wrong user group"==a.answer&&(b={message:"Данный функционал доступен только для клиентов"});var c=document.querySelector("#snackbar");c.MaterialSnackbar.showSnackbar(b)}).fail(function(a){var b={message:"Данный функционал доступен только для клиентов"},c=document.querySelector("#snackbar");c.MaterialSnackbar.showSnackbar(b)}),!1}function segmentOpen(a){$('[data-id="'+a+'"]').each(function(){0===$(this).find("ul").length&&(addLoadAnimation(".catalog"),ajax("segment","segmid",{idsegment:a},"html").done(function(b){$(".second_nav li").removeClass("active"),$('[data-id="'+a+'"]').append(b),$('[data-id="'+a+'"]').find(".link_wrapp").find("span").addClass("more_cat"),$('[data-id="'+a+'"]').find("ul").find("li").removeClass("active").find("ul").stop(!0,!0).slideUp();var c=($('[data-id="'+a+'"]').find("ul").data("lvl"),$('[data-id="'+a+'"]')),d=c.hasClass("active");d||c.addClass("active").find("> ul").stop(!0,!0).slideDown(),removeLoadAnimation(".catalog")}))})}function addressSelect(a){var b=a.closest("form"),c=a.val();ajax("location","addressSelect",{address:c},"html").done(function(a){b.find(".address_preview").html(a)})}function regionSelect(a){var b=a.closest("form"),c=a.val();addLoadAnimation(b),""!==c?ajax("location","regionSelect",{region:c},"html").done(function(a){b.find("select:not(#region) option").remove(),b.find("#city").html(a).prop("disabled",!1),b.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(b)}):(b.find("#city").html("").prop("disabled",!0),removeLoadAnimation(b))}function citySelect(a){var b=a.closest("form"),c=a.val(),d=b.find("#region").val();addLoadAnimation(b),""!==c&&""!==d?ajax("location","citySelect",{city:c,region:d},"html").done(function(a){b.find("select:not(#region, #city) option").remove(),b.find("#id_delivery").html(a).prop("disabled",!1),b.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(b)}):removeLoadAnimation(b)}function deliverySelect(a){var b=a.closest("form"),c=a.val(),d=b.find("#city").val(),e=b.find("#region").val();addLoadAnimation(b),ajax("location","deliverySelect",{city:d,region:e,id_delivery:c},"html").done(function(a){switch(b.find("#id_delivery_service option").remove(),b.find("#id_delivery_service").html(a).prop("required",!0).prop("disabled",!1),b.find(".id_delivery_service").closest("div.mdl-cell").removeClass("hidden"),c){case"1":b.find(".delivery_department").closest("div.mdl-cell").removeClass("hidden"),b.find(".address").closest("div.mdl-cell").addClass("hidden");break;case"2":b.find(".delivery_department").closest("div.mdl-cell").addClass("hidden"),b.find("#address").prop("required",!0).prop("disabled",!1).closest("div.mdl-cell").removeClass("hidden")}removeLoadAnimation(b)})}function deliveryServiceSelect(a){var b=a.closest("form"),c=b.find("#region").val(),d=b.find("#city").val(),e=b.find("#id_delivery").val(),f=a.val(),g=a.find("option:selected").data("ref");addLoadAnimation(b),1==e?ajax("location","deliveryServiceSelect",{city:d,region:c,shipping_comp:f,ref:g,id_delivery:e},"html").done(function(a){b.find("#delivery_department option").remove(),b.find("#delivery_department").html(a).prop({required:!0,disabled:!1}),b.find(".delivery_department").closest("div.mdl-cell").removeClass("hidden"),removeLoadAnimation(b)}):removeLoadAnimation(b)}function UpdateProductsList(a,b){ajax("products","getmoreproducts",b,"html").done(function(b){removeLoadAnimation(".products"),a.find(".products").html(b),componentHandler.upgradeDom(),$("img.lazy").lazyload({effect:"fadeIn"}),resizeAsideScroll("show_more")})}function SortProductsList(a){location.href=a.val()}function GetScreenshot(){var a=$(".err_msg_as_js").detach(),b=$("#snackbar").detach();$(document).outerWidth()<450?($(".waiting_block_for_img_canvas_js").css("top","0"),$("#header_js").css("top","52px")):$(".waiting_block_for_img_canvas_js").css("top","15px"),html2canvas(document.body,{onrendered:function(c){c.id="canvasImg";c.toDataURL("image/jpeg");$(".err_msg_as_wrap_js").css("display","none").append(a),$(".modals").append(b);var d=document.getElementById("savedImageCopy");d.src=c.toDataURL();var e=document.getElementById("savedCopyContainer");e.style.display="block",$(".err_msg_as_wrap_js").css("display","block"),$(".waiting_block_for_img_canvas_js").css("top","-52px"),$(document).outerWidth()<450&&($("#header_js").css("top","0"),$(".err_msg_as_form_js .mdl-textfield").css("height","calc(100vh - 345px)")),$(".err_msg_as_js").addClass("shown").css("top","calc(100% - "+$(".err_msg_as_js").outerHeight()+"px)"),$(".err_msg_as_form_js").find("textarea").focus(),$("#err_canvas").attr({width:"20",height:"20"}),clear_canvas()}})}function init(a,b){if(canvaso=document.getElementById("err_canvas"),!canvaso)return void alert("Ошибка! Canvas элемент не найден!");if(!canvaso.getContext)return void alert("Ошибка! canvas.getContext не найден!");if(contexto=canvaso.getContext("2d"),!contexto)return void alert("Ошибка! Не могу получить getContext!");var c=canvaso.parentNode;if(canvas=document.createElement("canvas"),!canvas)return void alert("Ошибка! Не могу создать canvas элемент!");switch(canvas.id="imageTemp",canvas.width=canvaso.width,canvas.height=canvaso.height,c.appendChild(canvas),context=canvas.getContext("2d"),context.strokeStyle=a,b){case"rect":tool=new tools.rect;break;case"fillrect":tool=new tools.fillrect;break;case"pencil":tool=new tools.pencil,context.lineWidth=4;break;case"eraser":tool=new tools.eraser,context.lineWidth=20}canvas.addEventListener("mousedown",ev_canvas,!1),canvas.addEventListener("mousemove",ev_canvas,!1),canvas.addEventListener("mouseup",ev_canvas,!1)}function ev_canvas(a){a._x=a.offsetX,a._y=a.offsetY;var b=tool[a.type];tool[a.type]&&b(a)}function img_update(){contexto.drawImage(canvas,0,0),context.clearRect(0,0,canvas.width,canvas.height)}function clear_canvas(){contexto.clearRect(0,0,canvaso.width,canvaso.height),$("#canvas_mark_wrapper").find("canvas:not(#err_canvas)").remove()}function СhangeValue(a){$("#"+a).data("prevnum")<$("#"+a).val()?$("#"+a).closest(".slider_wrap").find(".range_num").css("bottom","+=10%"):$("#"+a).data("prevnum")>$("#"+a).val()&&$("#"+a).closest(".slider_wrap").find(".range_num").css("bottom","-=10%"),$("#"+a).data("prevnum",$("#"+a).val()).closest(".slider_wrap").find(".range_num").text($("#"+a).val())}function onCommentSubmit(){alert("Коментарий о позиции будет отображен на сайте после премодерации.")}function GetOriginalPhoto(a){var b=a.find("img").attr("data-original-photo"),c=a.find("img").attr("alt");$("#big_photo img").attr({src:b,alt:c}),setTimeout(function(){openObject("big_photo"),$("#big_photo img").css("height",$('#big_photo[data-type="modal"]').outerHeight()+"px")},100)}function AddNoteArea(a){var b;b=a.hasClass("out_card_js")?a.closest(".specCont_js").find(".note"):a.closest(".card").find(".note"),b.removeClass("hidden"),b.hasClass("note_control")&&b.addClass("activeNoteArea")}function userInfoValidator(a){var b,c=a.val(),d=a.data("input-validate"),e=a.closest("div.mdl-textfield"),f=/^[\'А-Яа-я-ЇїІіЁё ]+$|^[\'A-Za-z- ]+$/gi,g=/(^([\w\.]+)@([\w]+)\.([\w]+)$)|(^$)/gi,h=/\+38 \(\d{3}\) \d{3}-\d{2}-\d{2}/,i=/^(0?[1-9])$|^([1-2]\d)$|^(3[0-1])$/,j=/^(19|20)\d{2}$/;switch(d){case"name":b=f.test(c);break;case"email":b=g.test(c);break;case"phone":c.replace(/\D/g,"").length>3?e.addClass("is-dirty"):e.removeClass("is-dirty"),b=h.test(c);break;case"day":b=i.test(c);break;case"year":b=j.test(c);break;case"file":b=""!=c}return b?e.removeClass("is-invalid"):e.addClass("is-invalid")}var canvas,context,canvaso,contexto,tool,tool_default="line",tools={};tools.pencil=function(){var a=this;this.started=!1,this.mousedown=function(b){context.beginPath(),context.moveTo(b._x,b._y),a.started=!0},this.mousemove=function(b){a.started&&(context.lineTo(b._x,b._y),context.stroke())},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,img_update())}},tools.rect=function(){var a=this;this.started=!1,this.mousedown=function(b){a.started=!0,a.x0=b._x,a.y0=b._y},this.mousemove=function(b){if(a.started){var c=Math.min(b._x,a.x0),d=Math.min(b._y,a.y0),e=Math.abs(b._x-a.x0),f=Math.abs(b._y-a.y0);context.clearRect(0,0,canvas.width,canvas.height),e&&f&&(context.lineWidth=3,context.strokeRect(c,d,e,f))}},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,img_update())}},tools.fillrect=function(){var a=this;this.started=!1,this.mousedown=function(b){a.started=!0,a.x0=b._x,a.y0=b._y},this.mousemove=function(b){if(a.started){var c=Math.min(b._x,a.x0),d=Math.min(b._y,a.y0),e=Math.abs(b._x-a.x0),f=Math.abs(b._y-a.y0);context.clearRect(0,0,canvas.width,canvas.height),e&&f&&context.fillRect(c,d,e,f)}},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,img_update())}},tools.line=function(){var a=this;this.started=!1,this.mousedown=function(b){a.started=!0,a.x0=b._x,a.y0=b._y},this.mousemove=function(b){a.started&&(context.clearRect(0,0,canvas.width,canvas.height),context.beginPath(),context.moveTo(a.x0,a.y0),context.lineTo(b._x,b._y),context.stroke(),context.closePath())},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,img_update())}},tools.eraser=function(){var a=this;this.started=!1,this.mousedown=function(b){context.beginPath(),context.moveTo(b._x,b._y),a.started=!0},this.mousemove=function(b){a.started&&(context.lineTo(b._x,b._y),context.stroke())},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,img_update())}};
function GetLocation(){navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.Geocoder,a={lat:e.coords.latitude,lng:e.coords.longitude};t.geocode({location:a},function(e,t){t===google.maps.GeocoderStatus.OK?e[2]?$(".mainUserInf .userlocation").html(e[2].formatted_address):$(".mainUserInf .userlocation").html(e[6].formatted_address):$(".mainUserInf .userlocation").addClass("hidden")})})}function GetCartAjax(){$("#cart > .modal_container").html(""),ajax("cart","GetCartPage",!1,"html").done(function(e){$("#cart > .modal_container").html(e),removeLoadAnimation("#cart"),Position($("#cart"))})}function GetQuizAjax(e){data={step:void 0===e.step?1:e.step},void 0!==e.id_user&&(data.id_user=e.id_user),void 0!==e.target_id_order&&(data.target_id_order=e.target_id_order),ajax("quiz","step",data,"html").done(function(e){$("#quiz").html(e),componentHandler.upgradeDom(),removeLoadAnimation("#quiz"),Position($("#quiz"))})}function GetGiftSelectAjax(){$("#gift_select > .modal_container").html(""),ajax("cart","giftSelect",!1,"html").done(function(e){$("#gift_select > .modal_container").html(e),removeLoadAnimation("#gift_select"),Position($("#gift_select"))})}function GetCabProdAjax(e,t){$(".content").addClass("loading"),ajax("cabinet","GetProdList",{id_order:e,rewrite:t},"html").done(function(e){$(".mdl-tabs__panel > #products").html(e),$(".content").removeClass("loading")})}function GetCabCoopProdAjax(e,t){ajax("cabinet","GetProdListForJO",{id_cart:e,rewrite:t},"html").done(function(e){$('a[href^="#items_panel_"]').hasClass("getCabCoopProdAjax_js")?$(".products_cart_js").html(e):($(".active_link_to_cart_js").closest("li").find(".products_cart_js").html(e),$(".list_in_cart_js").removeClass("active_link_to_cart_js"))})}function ModalDemandChart(e){ajax("product","OpenModalDemandChart",{id_category:e},"html").done(function(e){$("#demand_chart .modal_container").html(e),componentHandler.upgradeDom(),openObject("demand_chart")})}function ajax(e,t,a,o,i){return i?(a.append("target",e),a.append("action",t)):"object"==typeof a?(a.target=e,a.action=t):a={target:e,action:t},o=o||"json",$.ajax({url:URL_base+"ajax",beforeSend:function(e){ajax_proceed,ajax_proceed=!0},type:"POST",dataType:o,data:a,processData:!i,contentType:!i&&"application/x-www-form-urlencoded; charset=UTF-8"}).always(function(){ajax_proceed=!1})}function resizeAsideScroll(e){var t=$(window).height(),a=$(".main").height(),o=$(".main_nav").outerHeight(),i=$(this).scrollTop(),n=i+t-a-60+o;return i+t>CurentMainWindow+60?($("aside .catalog .second_nav").css("max-height","calc(100vh - 60px - "+n+"px"),$("aside .filters_container").css("max-height","calc(100vh - 60px - "+(n+43)+"px")):($("aside .catalog .second_nav").css("max-height","calc(100vh - "+(o+60)+"px"),$("aside .filters_container").css("max-height","calc(100vh - "+(o+60+43)+"px")),!0}function ChangeView(e){switch(e){case"list":$("#view_block_js").removeClass().addClass("list_view col-md-12 ajax_loading");break;case"block":$("#view_block_js").removeClass().addClass("block_view col-md-12 ajax_loading");break;case"column":$("#view_block_js").removeClass().addClass("column_view col-md-12 ajax_loading")}document.cookie="product_view="+e+"; path=/"}function ListenPhotoHover(){preview=$(".list_view .preview"),previewOwl=preview.find("#owl-product_slide_js"),$("body").on("mouseover",".list_view .product_photo:not(hovered)",function(){$(this).not(".hovered")&&(showPreview(!1),$(this).addClass("hovered"),rebuildPreview($(this)))}).on("mouseleave",".list_view .product_photo:not(hovered)",function(e){if($("#view_block_js").hasClass("list_view")){var t=mousePos(e),a=$(this);a.hasClass("hovered")&&(t.x<=a.offset().left||t.x>=a.offset().left+a.width()||t.y<=a.offset().top||t.y>=a.offset().top+a.height())&&(hidePreview(),a.removeClass("hovered"))}}),preview.on("mouseleave",function(e){$("#view_block_js").hasClass("list_view")&&(mp=mousePos(e),obj=$(".product_photo.hovered"),obj.hasClass("hovered")&&(mp.x<=obj.offset().left||mp.x>=obj.offset().left+obj.width()||mp.y<=obj.offset().top||mp.y>=obj.offset().top+obj.height())&&(hidePreview(),obj.removeClass("hovered")))})}function hidePreview(){preview.hide().addClass("ajax_loading"),previewOwl.data("owlCarousel")&&previewOwl.data("owlCarousel").destroy()}function rebuildPreview(e){var t=e.offset(),a=$("#view_block_js").offset(),o=e.closest(".card").data("idproduct"),i=($(window).width(),$(window).height()),n=getScrollWindow(),s=0,r=0,d=15+$("header").outerHeight(),c=t.top-preview.height()/2+e.outerHeight()/2-d,l=t.top+preview.height()/2+e.outerHeight()/2+15;n+i<l?s=l-(n+i):n>c&&(r=c-n),preview.css({top:t.top-a.top-preview.height()/2+e.height()/2-s-r,left:80}),t.top-preview.offset().top+e.height()/2+preview.find(".triangle").height()>preview.height()?preview.css("border-radius","5px 5px 5px 0").find(".triangle").css({top:"50%",left:20}):preview.offset().top>t.top+e.height()/2-preview.find(".triangle").height()?preview.css("border-radius","0 5px 5px 5px").find(".triangle").css({top:"50%",left:20}):preview.css("border-radius","5px").find(".triangle").css({top:t.top-preview.offset().top+e.height()/2,left:-7}),e.hasClass("hovered")?ajax("product","GetPreview",{id_product:o},"html").done(function(e){preview.find(".preview_content").html(e),componentHandler.upgradeDom(),showPreview(!0)}):preview.hide()}function getScrollWindow(){var e=document.documentElement,t=document.body,a=e.scrollTop||t&&t.scrollTop||0;return a-=e.clientTop}function changeToTop(e){var t=$("#toTop");e>$("html").height()/8?!1===t.hasClass("visible")&&t.addClass("visible"):t.hasClass("visible")&&t.removeClass("visible")}function showPreview(e){e?preview.removeClass("ajax_loading").find("#owl-product_slide_js").owlCarousel({center:!0,dots:!0,items:1,margin:20,nav:!0,video:!0,videoHeight:300,videoWidth:300,navText:['<svg class="arrow_left"><use xlink:href="images/slider_arrows.svg#arrow_left_tidy"></use></svg>','<svg class="arrow_right"><use xlink:href="images/slider_arrows.svg#arrow_right_tidy"></use></svg>']}):preview.show()}function mousePos(e){return{x:e.pageX,y:e.pageY}}function ChangePriceRange(e,t){var a=e==$.cookie("sum_range"),o="";if(1==t){if($.cookie("sum_range",e,{path:"/"}),$.cookie("manual",1,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+e).addClass("active"),e==$.cookie("sum_range")){switch(e){case 3:o="Без скидки!";break;case 2:o="При заказе от "+columnLimits[2]+" грн.";break;case 1:o="При заказе от "+columnLimits[1]+" грн.";break;case 0:o="При заказе от "+columnLimits[0]+" грн."}$(".order_balance").text(o)}}else 1!=$.cookie("manual")?($.cookie("sum_range",e,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+e).addClass("active"),e=e>0?e-1:0):e=$.cookie("sum_range");addLoadAnimation(".order_balance"),addLoadAnimation("#button-cart1"),ajax("cart","GetCart").done(function(t){if(removeLoadAnimation(".order_balance"),removeLoadAnimation("#button-cart1"),currentSum=t.products_sum[3],newSum=columnLimits[e]-currentSum,1!=$.cookie("manual")){switch(t.cart_column){case 3:o="Без скидки!";break;case 2:o="При заказе от "+columnLimits[2]+" грн.";break;case 1:o="При заказе от "+columnLimits[1]+" грн.";break;case 0:o="При заказе от "+columnLimits[0]+" грн."}$(".order_balance").text(o)}if($(":not(#cart) .product_buy").each(function(){var t=parseInt($(this).find(".minQty").val()),a=parseInt($(this).find(".qty_js").val()),o=parseFloat($(this).find(".price"+(a>=t?"Opt":"Mopt")+e).val()).toFixed(2).toString().replace(".",","),i=$(this).find(".basePrice"+(a>=t?"Opt":"Mopt")+e).val();a>=t?$(this).find(".priceMoptInf").addClass("hidden"):$(this).find(".priceMoptInf").removeClass("hidden"),$(this).find(".price").html(o),$(this).find(".base_price").html(i)}),!0===a&&setTimeout(function(){$(".product_buy .product_price *").stop(!0,!0).css({color:"#FF5722"}).delay(1e3).animate({color:"#444444"},3e3)},300),$("#cart").hasClass("opened")){var i=parseInt($("#cart .cart_buttons .min_sum_order").val()),n=parseInt($("#cart .cart_buttons .current_user").val());t.products_sum[3]<i&&4!=n?($("#button-cart1 button").addClass("hidden"),$("#button-cart1 p").removeClass("hidden")):($("#button-cart1 button").removeClass("hidden"),$("#button-cart1 p").addClass("hidden"))}})}function openObject(e,t){switch(e){case"gift_select":GetGiftSelectAjax(t);break;case"cart":GetCartAjax(t);break;case"quiz":void 0===t&&(t={reload:!1}),GetQuizAjax(t)}if(void 0===t||!0!==t.reload){var a=$("#"+e),o=a.data("type");$("html").hasClass("active_bg")&&$('.opened:not([id="'+a.attr("id")+'"])').each(function(e,t){closeObject($(this).attr("id"))}),a.hasClass("opened")&&"search"!=o?(closeObject(a.attr("id")),DeactivateBG()):("cart"==e&&addLoadAnimation("#"+e),"phone_menu"==e&&$('[data-name="phone_menu"] i').text("close"),"modal"==o?(a.find(".modal_container").css({"max-height":.8*$(window)}),Position(a.addClass("opened"))):a.addClass("opened"),ActivateBG())}}function closeObject(e){void 0===e?$(".opened").each(function(e,t){closeObject($(this).attr("id"))}):($("#"+e).removeClass("opened"),"phone_menu"==e&&$('[data-name="phone_menu"] i').text("menu")),DeactivateBG()}function Position(e){e.css({top:($(window).height()+52-e.outerHeight())/2,left:($(window).width()-e.outerWidth())/2})}function ActivateBG(){$("html").addClass("active_bg")}function DeactivateBG(){$("html").removeClass("active_bg")}function closePanel(){$(".menu").html("menu"),$(".panel").slideUp()}function changestars(e){$(".set_rating").each(function(){$(this).next("i").text(parseInt($(this).val())<=parseInt(e)?"star":"star_border")})}function ValidatePass(e,t){var a,o=0,i=t.closest(".forPassStrengthContainer_js");return new RegExp("^(?=.*[a-zа-я]).*$","g").test(e)&&o++,new RegExp("^(?=.*[A-ZА-Я]).*$","g").test(e)&&o++,new RegExp("^(?=.*[0-9]).*$","g").test(e)&&o++,new RegExp("^(?=.*[!,@,#,$,%,^,&,*,?,_,~,-,=]).*$","g").test(e)&&o++,1==o&&($("#passwd + .mdl-textfield__error").empty(),i.find(".ps_lvl_js").addClass("bad").removeClass("better").removeClass("ok").removeClass("best"),a=!1),2==o&&(i.find(".ps_lvl_js").addClass("better").removeClass("ok").removeClass("best"),a=!1),3==o&&(i.find(".ps_lvl_js").addClass("ok").removeClass("best"),a=!1),4==o&&(i.find(".ps_lvl_js").addClass("best"),a=!1),e.length<1?($("#passwd + .mdl-textfield__error").empty(),i.find(".ps_lvl_js").removeClass("bad").removeClass("better").removeClass("ok").removeClass("best"),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").find(".mdl-textfield__error").text("Введите пароль")):e.length>=1&&e.length<4&&($("#passwd + .mdl-textfield__error").empty(),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароль слишком короткий")),a}function ValidatePassConfirm(e,t){if(t===e&&t)return $('[name="passwdconfirm"]').closest(".mdl-textfield").removeClass("is-invalid").find(".mdl-textfield__error").text("Пароли совпали").css({visibility:"visible",color:"#018b06"}),$('[name="passwdconfirm"]').val().length>=4&&$(".verification_btn").removeAttr("disabled"),!1;$('[name="passwdconfirm"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароли не совпадают").css({visibility:"visible",color:"#D50000"}),$(".verification_btn").attr("disabled","disabled")}function ValidateEmail(e,t){ajax("auth","register",e).done(function(e){return removeLoadAnimation("#registration"),e})}function ValidateName(e){if(!(e.length<3))return $("#name ~ .mdl-textfield__error").empty(),!1;$("#name ~ .mdl-textfield__error").empty(),$("#name").closest(".mdl-textfield ").addClass("is-invalid"),0===e.length?$("#name ~ .mdl-textfield__error").append("Введите имя"):$("#name ~ .mdl-textfield__error").append("Имя слишком короткое")}function CompleteValidation(e,t,a,o){var i=0,n=!1;return(n=ValidateName(e))&&($("#regs .mdl-textfield__error").closest("#name .mdl-textfield").text(n),i++),t&&($("#regs .mdl-textfield__error").closest("#email .mdl-textfield").text(t),i++),(n=ValidatePass(a))&&($("#regs .mdl-textfield__error").closest("#passwd .mdl-textfield").text(n),i++),(n=ValidatePassConfirm(a,o))&&($("#regs .mdl-textfield__error").closest("#passwdconfirm .mdl-textfield").text(n),i++),!(i>0)}function moveObjects(){$('div:not(.modals) [data-type="modal"]').each(function(e,t){$(".modals").append(t)}),$('div:not(.panels) [data-type="panel"]').each(function(e,t){$(".panels").append(t)})}function DelFromAssort(e){ajax("product","DelFromAssort",{id_product:e.closest(".products_list_item").data("id-product")}).done(function(){e.closest(".products_list_item").slideUp()})}function toAssort(e,t,a,o){var i=$(".inusd"+e).prop("checked"),n=($("#currency_rate").val(),1==t?"opt":"mopt"),s=parseFloat($("#price_"+n+"_otpusk_"+e).val().replace(",",".")),r=(parseFloat($("#price_"+n+"_otpusk_"+e).val().replace(",",".")),parseFloat($("#product_limit_mopt_"+e).val()),0);$("#balance_info-"+e+" input").is(":checked")&&(r=1),ajax("supplier","updateAssort",{mode:n,id_product:e,price:s,active:r,comment:o,inusd:!1===i?0:1})}function AddDelProductAssortiment(e,t){ajax("product",e.checked?"AddToAssort":"DelFromAssort",{id_product:t})}function setCookie(e,t){var a=escape(t),o=new Date;if(a.length<=4e3){o.setTime(o.getTime()+31536e6);var i=o.toGMTString();document.cookie=e+"="+a+"; path=/; expires="+i+";"}}function getCookie(e){var t=e+"=",a=document.cookie.indexOf(t);if(-1==a)return null;var o=document.cookie.indexOf(";",a+t.length);return-1==o&&(o=document.cookie.length),unescape(document.cookie.substring(a+t.length,o))}function addLoadAnimation(e){"object"==typeof e&&0===e.has(".loadBlock").length?e.append('<div class="loadBlock"><div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active loadAnimation"></div></div>'):0===$(e).has(".loadBlock").length&&$(e).append('<div class="loadBlock"><div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active loadAnimation"></div></div>'),componentHandler.upgradeDom()}function removeLoadAnimation(e){"object"==typeof e&&e.has(".loadBlock").length>0?e.find(".loadBlock").remove():$(e).has(".loadBlock").length>0&&$(e).find(".loadBlock").remove(),componentHandler.upgradeDom()}function toggleFavorite(e,t,a){}function AddFavorite(e,t,a){return console.log(a),console.log(t),ajax("product","add_favorite",{id_product:e}).done(function(e){var a={};"login"==e.answer?(openObject("auth"),removeLoadAnimation("#auth")):"already"==e.answer?a={message:"Товар уже находится в избранном"}:"ok"==e.answer?($(".userChoiceFav").text("("+e.fav_count+")"),a={message:"Товар добавлен в избранное"},t.attr("title","Убрать из избранного").find("i").html("favorite")):"wrong user group"==e.answer&&(a={message:"Данный функционал доступен только для клиентов"}),document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(a)}).fail(function(e){alert("Error")}),!1}function RemoveFavorite(e,t,a){return ajax("product","del_favorite",{id_product:e}).done(function(e){var a={};"login"==e.answer?(openObject("auth"),removeLoadAnimation("#auth")):"ok"==e.answer?($(".userChoiceFav").text("("+e.fav_count+")"),a={message:"Товар удален из избранного"},t.attr("title","В избранное").find("i").html("favorite_border")):"wrong user group"==e.answer&&(a={message:"Данный функционал доступен только для клиентов"}),document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(a)}).fail(function(e){alert("Error")}),!1}function AddInWaitingList(e,t,a,o){return ajax("product","add_in_waitinglist",{id_product:e,id_user:t,email:a}).done(function(e){var t={};"login"==e.answer?(openObject("auth"),removeLoadAnimation("#auth")):"already"==e.answer?t={message:"Товар уже в списке ожидания"}:"ok"==e.answer?($(".userChoiceWait").text("("+e.fav_count+")"),t={message:"Товар добавлен в список ожидания"},o.attr("title","Не следить за ценой")):"wrong user group"==e.answer&&(t={message:"Данный функционал доступен только для клиентов"}),document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(t)}).fail(function(e){var t={message:"Данный функционал доступен только для клиентов"};document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(t)}),!1}function RemoveFromWaitingList(e,t,a,o){return ajax("product","del_from_waitinglist",{id_product:e,id_user:t,email:a}).done(function(e){var t={};"login"==e.answer?(openObject("auth"),removeLoadAnimation("#auth")):"ok"==e.answer?($(".userChoiceWait").text("("+e.fav_count+")"),t={message:"Товар удален из списка ожидания"},o.attr("title","Следить за ценой")):"wrong user group"==e.answer&&(t={message:"Данный функционал доступен только для клиентов"}),document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(t)}).fail(function(e){var t={message:"Данный функционал доступен только для клиентов"};document.querySelector("#snackbar").MaterialSnackbar.showSnackbar(t)}),!1}function segmentOpen(e){$('[data-id="'+e+'"]').each(function(){0===$(this).find("ul").length&&(addLoadAnimation(".catalog"),ajax("segment","segmid",{idsegment:e},"html").done(function(t){$(".second_nav li").removeClass("active"),$('[data-id="'+e+'"]').append(t),$('[data-id="'+e+'"]').find(".link_wrapp").find("span").addClass("more_cat"),$('[data-id="'+e+'"]').find("ul").find("li").removeClass("active").find("ul").stop(!0,!0).slideUp();$('[data-id="'+e+'"]').find("ul").data("lvl");var a=$('[data-id="'+e+'"]');a.hasClass("active")||a.addClass("active").find("> ul").stop(!0,!0).slideDown(),removeLoadAnimation(".catalog")}))})}function addressSelect(e){var t=e.closest("form");ajax("location","addressSelect",{address:e.val()},"html").done(function(e){t.find(".address_preview").html(e)})}function regionSelect(e){var t=e.closest("form"),a=e.val();addLoadAnimation(t),""!==a?ajax("location","regionSelect",{region:a},"html").done(function(e){t.find("select:not(#region) option").remove(),t.find("#city").html(e).prop("disabled",!1),t.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)}):(t.find("#city").html("").prop("disabled",!0),removeLoadAnimation(t))}function citySelect(e){var t=e.closest("form"),a=e.val(),o=t.find("#region").val();addLoadAnimation(t),""!==a&&""!==o?ajax("location","citySelect",{city:a,region:o},"html").done(function(e){t.find("select:not(#region, #city) option").remove(),t.find("#id_delivery").html(e).prop("disabled",!1),t.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)}):removeLoadAnimation(t)}function deliverySelect(e){var t=e.closest("form"),a=e.val(),o=t.find("#city").val(),i=t.find("#region").val();addLoadAnimation(t),ajax("location","deliverySelect",{city:o,region:i,id_delivery:a},"html").done(function(e){switch(t.find("#id_delivery_service option").remove(),t.find("#id_delivery_service").html(e).prop("required",!0).prop("disabled",!1),t.find(".id_delivery_service").closest("div.mdl-cell").removeClass("hidden"),a){case"1":t.find(".delivery_department").closest("div.mdl-cell").removeClass("hidden"),t.find(".address").closest("div.mdl-cell").addClass("hidden");break;case"2":t.find(".delivery_department").closest("div.mdl-cell").addClass("hidden"),t.find("#address").prop("required",!0).prop("disabled",!1).closest("div.mdl-cell").removeClass("hidden")}removeLoadAnimation(t)})}function deliveryServiceSelect(e){var t=e.closest("form"),a=t.find("#region").val(),o=t.find("#city").val(),i=t.find("#id_delivery").val(),n=e.val(),s=e.find("option:selected").data("ref");addLoadAnimation(t),1==i?ajax("location","deliveryServiceSelect",{city:o,region:a,shipping_comp:n,ref:s,id_delivery:i},"html").done(function(e){t.find("#delivery_department option").remove(),t.find("#delivery_department").html(e).prop({required:!0,disabled:!1}),t.find(".delivery_department").closest("div.mdl-cell").removeClass("hidden"),removeLoadAnimation(t)}):removeLoadAnimation(t)}function UpdateProductsList(e,t){ajax("products","getmoreproducts",t,"html").done(function(t){removeLoadAnimation(".products"),e.find(".products").html(t),componentHandler.upgradeDom(),$("img.lazy").lazyload({effect:"fadeIn"}),resizeAsideScroll("show_more")})}function SortProductsList(e){location.href=e.val()}function GetScreenshot(){var e=$(".err_msg_as_js").detach(),t=$("#snackbar").detach();$(document).outerWidth()<450?($(".waiting_block_for_img_canvas_js").css("top","0"),$("#header_js").css("top","60px")):$(".waiting_block_for_img_canvas_js").css("top","15px"),html2canvas(document.body,{onrendered:function(a){a.id="canvasImg";a.toDataURL("image/jpeg");$(".err_msg_as_wrap_js").css("display","none").append(e),$(".modals").append(t),document.getElementById("savedImageCopy").src=a.toDataURL(),document.getElementById("savedCopyContainer").style.display="block",$(".err_msg_as_wrap_js").css("display","block"),$(".waiting_block_for_img_canvas_js").css("top","-60px"),$(document).outerWidth()<450&&($("#header_js").css("top","0"),$(".err_msg_as_form_js .mdl-textfield").css("height","calc(100vh - 345px)")),$(".err_msg_as_js").addClass("shown").css("top","0"),$(".err_msg_as_form_js").find("textarea").focus(),$("#err_canvas").attr({width:"20",height:"20"}),clear_canvas()}})}function init(e,t){if(canvaso=document.getElementById("err_canvas"))if(canvaso.getContext)if(contexto=canvaso.getContext("2d")){var a=canvaso.parentNode;if(canvas=document.createElement("canvas")){switch(canvas.id="imageTemp",canvas.width=canvaso.width,canvas.height=canvaso.height,a.appendChild(canvas),context=canvas.getContext("2d"),context.strokeStyle=e,t){case"rect":tool=new tools.rect;break;case"fillrect":tool=new tools.fillrect;break;case"pencil":tool=new tools.pencil,context.lineWidth=4;break;case"eraser":tool=new tools.eraser,context.lineWidth=20}canvas.addEventListener("mousedown",ev_canvas,!1),canvas.addEventListener("mousemove",ev_canvas,!1),canvas.addEventListener("mouseup",ev_canvas,!1)}else alert("Ошибка! Не могу создать canvas элемент!")}else alert("Ошибка! Не могу получить getContext!");else alert("Ошибка! canvas.getContext не найден!");else alert("Ошибка! Canvas элемент не найден!")}function ev_canvas(e){e._x=e.offsetX,e._y=e.offsetY;var t=tool[e.type];tool[e.type]&&t(e)}function img_update(){contexto.drawImage(canvas,0,0),context.clearRect(0,0,canvas.width,canvas.height)}function clear_canvas(){contexto.clearRect(0,0,canvaso.width,canvaso.height),$("#canvas_mark_wrapper").find("canvas:not(#err_canvas)").remove()}function СhangeValue(e){$("#"+e).data("prevnum")<$("#"+e).val()?$("#"+e).closest(".slider_wrap").find(".range_num").css("bottom","+=10%"):$("#"+e).data("prevnum")>$("#"+e).val()&&$("#"+e).closest(".slider_wrap").find(".range_num").css("bottom","-=10%"),$("#"+e).data("prevnum",$("#"+e).val()).closest(".slider_wrap").find(".range_num").text($("#"+e).val())}function onCommentSubmit(){alert("Коментарий о позиции будет отображен на сайте после премодерации.")}function GetOriginalPhoto(e){var t=e.find("img").attr("data-original-photo"),a=e.find("img").attr("alt");$("#big_photo img").attr({src:t,alt:a}),setTimeout(function(){openObject("big_photo"),$("#big_photo img").css("height",$('#big_photo[data-type="modal"]').outerHeight()+"px")},100)}function AddNoteArea(e){var t;(t=e.hasClass("out_card_js")?e.closest(".specCont_js").find(".note"):e.closest(".card").find(".note")).removeClass("hidden"),t.hasClass("note_control")&&t.addClass("activeNoteArea")}function userInfoValidator(e){var t,a=e.val(),o=e.data("input-validate"),i=e.closest("div.mdl-textfield"),n=/^[\'А-Яа-я-ЇїІіЁё ]+$|^[\'A-Za-z- ]+$/gi,s=/(^([\w\.]+)@([\w]+)\.([\w]+)$)|(^$)/gi,r=/\+38 \(\d{3}\) \d{3}-\d{2}-\d{2}/,d=/^(0?[1-9])$|^([1-2]\d)$|^(3[0-1])$/,c=/^(19|20)\d{2}$/;switch(o){case"name":t=n.test(a);break;case"email":t=s.test(a);break;case"phone":a.replace(/\D/g,"").length>3?i.addClass("is-dirty"):i.removeClass("is-dirty"),t=r.test(a);break;case"day":t=d.test(a);break;case"year":t=c.test(a);break;case"file":t=""!=a}return t?i.removeClass("is-invalid"):i.addClass("is-invalid")}var canvas,context,canvaso,contexto,tool,tool_default="line",tools={};tools.pencil=function(){var e=this;this.started=!1,this.mousedown=function(t){context.beginPath(),context.moveTo(t._x,t._y),e.started=!0},this.mousemove=function(t){e.started&&(context.lineTo(t._x,t._y),context.stroke())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.rect=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){if(e.started){var a=Math.min(t._x,e.x0),o=Math.min(t._y,e.y0),i=Math.abs(t._x-e.x0),n=Math.abs(t._y-e.y0);context.clearRect(0,0,canvas.width,canvas.height),i&&n&&(context.lineWidth=3,context.strokeRect(a,o,i,n))}},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.fillrect=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){if(e.started){var a=Math.min(t._x,e.x0),o=Math.min(t._y,e.y0),i=Math.abs(t._x-e.x0),n=Math.abs(t._y-e.y0);context.clearRect(0,0,canvas.width,canvas.height),i&&n&&context.fillRect(a,o,i,n)}},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.line=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){e.started&&(context.clearRect(0,0,canvas.width,canvas.height),context.beginPath(),context.moveTo(e.x0,e.y0),context.lineTo(t._x,t._y),context.stroke(),context.closePath())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.eraser=function(){var e=this;this.started=!1,this.mousedown=function(t){context.beginPath(),context.moveTo(t._x,t._y),e.started=!0},this.mousemove=function(t){e.started&&(context.lineTo(t._x,t._y),context.stroke())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}};
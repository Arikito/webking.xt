function GetLocation(){var e;return navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.Geocoder,a={lat:e.coords.latitude,lng:e.coords.longitude};t.geocode({location:a},function(e,t){t===google.maps.GeocoderStatus.OK?e[2]?$(".mainUserInf .userlocation").html(e[2].formatted_address):$(".mainUserInf .userlocation").html(e[6].formatted_address):$(".mainUserInf .userlocation").addClass("hidden")})}),e}function GetCartAjax(){$("#cart > .modal_container").html(""),ajax("cart","GetCartPage",!1,"html").done(function(e){$("#cart > .modal_container").html(e),removeLoadAnimation("#cart"),Position($("#cart"))})}function GetQuizAjax(e){var t=void 0===e.step?1:e.step;data={step:t},ajax("quiz","step",data,"html").done(function(e){$("#quiz").html(e),componentHandler.upgradeDom(),removeLoadAnimation("#quiz"),Position($("#quiz"))})}function GetCabProdAjax(e,t){$(".content").addClass("loading"),ajax("cabinet","GetProdList",{id_order:e,rewrite:t},"html").done(function(e){$(".mdl-tabs__panel > #products").html(e),$(".content").removeClass("loading")})}function GetCabCoopProdAjax(e,t){ajax("cabinet","GetProdListForJO",{id_cart:e,rewrite:t},"html").done(function(e){$('a[href^="#items_panel_"]').hasClass("getCabCoopProdAjax_js")?$(".products_cart_js").html(e):($(".active_link_to_cart_js").closest("li").find(".products_cart_js").html(e),$(".list_in_cart_js").removeClass("active_link_to_cart_js"))})}function UserRating(e){var t=$(".manager").data("id"),a=0;e.is(".like")&&(a=1),ajax("cabinet","GetRating",{id_user:t,bool:a}).done(function(e){0===e&&openObject("modal_message")})}function Graf3d(){function e(e,t){var a=d3.select("#legend").html("").selectAll(".row").data(_.keys(e).sort()),o=a.enter().append("div").attr("title","Hide group").on("click",function(e){_.contains(q,e)?(d3.select(this).attr("title","Hide group"),q=_.difference(q,[e]),t()):(d3.select(this).attr("title","Show group"),q.push(e),t())});return o.append("span").style("background",function(e,t){return c(e,.85)}).attr("class","color-bar"),o.append("span").attr("class","tally").text(function(e,t){return 0}),o.append("span").text(function(e,t){return" "+e}),o}function t(e,t,a,o){e.slice(t,a).forEach(function(e){d(e,S,c(e.group,o))})}function a(e){var t=e.sort(function(e,t){var a=d3.keys(e)[0];return e[a]<t[a]?-1:1}),a=d3.select("#food-list").html("").selectAll(".row").data(t).enter().append("div").on("mouseover",s).on("mouseout",r);a.append("span").attr("class","color-block").style("background",function(e){return c(e.group,.85)}),a.append("span").text(function(e){return e.name})}function o(e){var t=(new Date).getTime()-e;return H=Math.max(Math.ceil(30*H/t),8),H=Math.min(H,300),(new Date).getTime()}function n(e,t,a){d3.select("#rendered-count").text(e),d3.select("#rendered-bar").style("width",100*e/t+"%"),d3.select("#render-speed").text(a)}function i(e,t,a){d3.select("#data-count").text(a),d3.select("#selected-count").text(t),d3.select("#selected-bar").style("width",100*t/a+"%"),d3.select("#opacity").text((""+100*e).slice(0,4)+"%")}function s(e){d3.select("#foreground").style("opacity","0.25"),d3.selectAll(".row").style("opacity",function(t){return e.group==t?null:"0.3"}),d(e,L,c(e.group,1))}function r(){d3.select("#foreground").style("opacity",null),d3.selectAll(".row").style("opacity",null),L.clearRect(0,0,O,R)}function l(e){var t=null;return z[e].brush.empty()||(t=z[e].brush.extent()),z[e].inverted===!0?(z[e].range([R,0]),d3.selectAll(".label").filter(function(t){return t==e}).style("text-decoration",null),z[e].inverted=!1):(z[e].range([0,R]),d3.selectAll(".label").filter(function(t){return t==e}).style("text-decoration","underline"),z[e].inverted=!0),t}function d(e,t,a){a&&(t.strokeStyle=a),t.beginPath();var o=E(0)-15,n=z[F[0]](e[F[0]]);t.moveTo(o,n),F.map(function(a,i){var s=E(a),r=z[a](e[a]),l=s-.88*(s-o),d=n,c=s-.12*(s-o),u=r;t.bezierCurveTo(l,d,c,u,s,r),o=s,n=r}),t.lineTo(o+15,n),t.stroke()}function c(e,t){W[e];return["hsl(120,100%,25%)"].join("")}function u(e){var t=I[e];return null===t?E(e):t}function p(){U++;var e=F.filter(function(e){return!z[e].brush.empty()}),t=e.map(function(e){return z[e].brush.extent()});d3.selectAll(".dimension")[0].forEach(function(a,o){var n=d3.select(a).data()[0];if(_.include(e,n)){var i=t[e.indexOf(n)];d3.select(a).selectAll("text").style("font-weight","bold").style("font-size","13px").style("display",function(){var e=d3.select(this).data();return i[0]<=e&&e<=i[1]?null:"none"})}else d3.select(a).selectAll("text").style("font-size",null).style("font-weight",null).style("display",null);d3.select(a).selectAll(".label").style("display",null)});d3.selectAll(".label").style("font-weight",function(t){return _.include(e,t)?"bold":null});var a=[];A.filter(function(e){return!_.contains(q,e.group)}).map(function(o){return e.every(function(e,a){return t[a][0]<=o[e]&&o[e]<=t[a][1]})?a.push(o):null});var o=d3.select("#search")[0][0].value;o.length>0&&(a=j(a,o)),a.length<A.length&&a.length>0?(d3.select("#keep-data").attr("disabled",null),d3.select("#exclude-data").attr("disabled",null)):(d3.select("#keep-data").attr("disabled","disabled"),d3.select("#exclude-data").attr("disabled","disabled"));var n=_(a).groupBy(function(e){return e.group});_(W).each(function(e,t){n[t]=n[t]||[]}),T.style("text-decoration",function(e){return _.contains(q,e)?"line-through":null}).attr("class",function(e){return n[e].length>0?"row":"row off"}),T.selectAll(".color-bar").style("width",function(e){return Math.ceil(600*n[e].length/A.length)+"px"}),T.selectAll(".tally").text(function(e,t){return n[e].length}),m(a,S,U,!0)}function m(e,s,r){function l(){if(c>=d||U>r)return!0;var e=d3.min([c+H,d]);t(shuffled_data,c,e,u),n(e,d,H),c=e,p=o(p)}var d=e.length,c=0,u=d3.min([2/Math.pow(d,.3),1]),p=(new Date).getTime();i(u,d,A.length),shuffled_data=_.shuffle(e),a(shuffled_data.slice(0,25)),s.clearRect(0,0,O+1,R+1),d3.timer(l)}function v(e,t){if(e){var a=d3.selectAll(".brush").filter(function(t){return t==e});t?a.call(z[e].brush=d3.svg.brush().y(z[e]).extent(t).on("brush",p)):a.call(z[e].brush=d3.svg.brush().y(z[e]).on("brush",p))}else d3.selectAll(".brush").each(function(e){d3.select(this).call(z[e].brush=d3.svg.brush().y(z[e]).on("brush",p))});U++,$(),d3.selectAll(".axis").each(function(e,t){d3.select(this).selectAll("line").style("display","none"),d3.select(this).transition().duration(720).call(B.scale(z[e])),d3.select(this).selectAll("line").transition().delay(800).style("display",null),d3.select(this).selectAll("text").style("font-weight",null).style("font-size",null).style("display",null)})}function f(){F.forEach(function(e,t){z[e].inverted?(z[e]=d3.scale.linear().domain(d3.extent(A,function(t){return+t[e]})).range([0,R]),z[e].inverted=!0):z[e]=d3.scale.linear().domain(d3.extent(A,function(t){return+t[e]})).range([R,0])}),v(),m(A,S,U)}function h(){var e=F.filter(function(e){return!z[e].brush.empty()}),t=e.map(function(e){return z[e].brush.extent()}),a=[];A.filter(function(e){return!_.contains(q,e.group)}).map(function(o){return e.every(function(e,a){return t[a][0]<=o[e]&&o[e]<=t[a][1]})?a.push(o):null});var o=d3.select("#search")[0][0].value;return o>0&&(a=j(a,o)),a}function g(){var e=d3.keys(A[0]),t=h().map(function(t){return e.map(function(e){return t[e]})}),a=d3.csv.format([e].concat(t)).replace(/\n/g,"<br/>\n"),o="<style>body { font-family: sans-serif; font-size: 12px; }</style>";window.open("text/csv").document.write(o+a)}function x(){return new_data=h(),0===new_data.length?(alert("I don't mean to be rude, but I can't let you remove all the data.\n\nTry removing some brushes to get your data back. Then click 'Keep' when you've selected data you want to look closer at."),!1):(A=new_data,void f())}function b(){return new_data=_.difference(A,h()),0===new_data.length?(alert("I don't mean to be rude, but I can't let you remove all the data.\n\nTry selecting just a few data points then clicking 'Exclude'."),!1):(A=new_data,void f())}function y(e,t){F=_.difference(F,[e]),E.domain(F),t.attr("transform",function(e){return"translate("+u(e)+")"}),t.filter(function(t){return t==e}).remove(),v()}function w(){d3.selectAll(".axis g").style("display","none"),d3.selectAll(".background").style("visibility","hidden"),d3.selectAll("#hide-ticks").attr("disabled","disabled"),d3.selectAll("#show-ticks").attr("disabled",null)}function $(){d3.selectAll(".axis g").style("display",null),d3.selectAll(".background").style("visibility",null),d3.selectAll("#show-ticks").attr("disabled","disabled"),d3.selectAll("#hide-ticks").attr("disabled",null)}function k(){d3.select("body").attr("class","dark"),d3.selectAll("#dark-theme").attr("disabled","disabled"),d3.selectAll("#light-theme").attr("disabled",null)}function C(){d3.select("body").attr("class",null),d3.selectAll("#light-theme").attr("disabled","disabled"),d3.selectAll("#dark-theme").attr("disabled",null)}function j(e,t){return pattern=new RegExp(t,"i"),_(e).filter(function(e){return pattern.exec(e.name)})}var A,S,P,L,F,T,G=900,M=260,D=[60,0,10,0],O=G,R=M,E=d3.scale.ordinal().rangePoints([0,O],1),z={},I={},B=(d3.svg.line(),d3.svg.axis().orient("left").ticks(1+M/50)),H=50,U=0,q=[],W={"Baby Foods":[185,56,73],"Baked Products":[37,50,75],"Beef Products":[325,50,39],Beverages:[10,28,67],"Breakfast Cereals":[271,39,57],"Cereal Grains and Pasta":[56,58,73],"Dairy and Egg Products":[28,100,52],"Ethnic Foods":[41,75,61],"Fast Foods":[60,86,61],"Fats and Oils":[30,100,73],"Finfish and Shellfish Products":[318,65,67],"Fruits and Fruit Juices":[274,30,76],"Lamb, Veal, and Game Products":[20,49,49],"Legumes and Legume Products":[334,80,84],"Meals, Entrees, and Sidedishes":[185,80,45],"Nut and Seed Products":[10,30,42],"Pork Products":[339,60,49],"Poultry Products":[359,69,49],"Restaurant Foods":[204,70,41],"Sausages and Luncheon Meats":[1,100,79],Snacks:[189,57,75],"Soups, Sauces, and Gravies":[110,57,70],"Spices and Herbs":[214,55,79],Sweets:[339,60,75],"Vegetables and Vegetable Products":[120,56,40]};d3.select("#chart").style("height",R+"px"),d3.selectAll("canvas").attr("width",O).attr("height",R).style("padding",D.join("px ")+"px"),S=document.getElementById("foreground").getContext("2d"),S.globalCompositeOperation="destination-over",S.strokeStyle="rgba(0,100,160,0.1)",S.lineWidth=1.7,S.fillText("Loading...",O/2,R/2),L=document.getElementById("highlight").getContext("2d"),L.strokeStyle="rgba(0,100,160,1)",L.lineWidth=4,P=document.getElementById("background").getContext("2d"),P.strokeStyle="rgba(0,100,160,0.1)",P.lineWidth=1.7;var N=d3.select("svg").attr("width",O).attr("height",R).append("svg:g").attr("transform","translate("+D[3]+","+D[0]+")");d3.json(URL_base+"js/nutrients.json",function(t){var a=t;A=a.map(function(e){for(var a in e)console.log(a,e),_.isNaN(t[0][a]-0)||"id"==a||(e[a]=parseFloat(e[a])||0,console.log(e[a]),console.log(parseFloat(e[a])));return e}),E.domain(F=d3.keys(A[0]).filter(function(e){return _.isNumber(A[0][e])&&(z[e]=d3.scale.linear().domain(d3.extent(A,function(t){return+t[e]})).range([R,0]))}).sort());var o=N.selectAll(".dimension").data(F).enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+E(e)+")"}).call(d3.behavior.drag().on("dragstart",function(e){I[e]=this.__origin__=E(e),this.__dragged__=!1,d3.select("#foreground").style("opacity","0.35")}).on("drag",function(e){I[e]=Math.min(O,Math.max(0,this.__origin__+=d3.event.dx)),F.sort(function(e,t){return u(e)-u(t)}),E.domain(F),o.attr("transform",function(e){return"translate("+u(e)+")"}),U++,this.__dragged__=!0,I[e]<12||I[e]>O-12?d3.select(this).select(".background").style("fill","#b00"):d3.select(this).select(".background").style("fill",null)}).on("dragend",function(e){var t=null;this.__dragged__?(d3.select(this).transition().attr("transform","translate("+E(e)+")"),t=z[e].brush.extent()):t=l(e),(I[e]<12||I[e]>O-12)&&y(e,o),E.domain(F),v(e,t),d3.select("#foreground").style("opacity",null),p(),delete this.__dragged__,delete this.__origin__,delete I[e]}));o.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(B.scale(z[e]))}).append("svg:text").attr("text-anchor","middle").attr("y",function(e,t){return t%2===0?-14:-30}).attr("x",0).attr("class","label").text(String).append("title").text("Click to invert. Drag to reorder"),o.append("svg:g").attr("class","brush").each(function(e){d3.select(this).call(z[e].brush=d3.svg.brush().y(z[e]).on("brush",p))}).selectAll("rect").style("visibility",null).attr("x",-23).attr("width",36).append("title").text("Drag up or down to brush along this axis"),o.selectAll(".extent").append("title").text("Drag or resize this filter"),T=e(W,p),p()}),window.onresize=function(){G=900,M=260,O=G,R=M,d3.select("#chart").style("height",R+"px"),d3.selectAll("canvas").attr("width",O).attr("height",R).style("padding",D.join("px ")+"px"),d3.select("svg").attr("width",O).attr("height",R).select("g").attr("transform","translate("+D[3]+","+D[0]+")"),E=d3.scale.ordinal().rangePoints([0,O],1).domain(F),F.forEach(function(e){z[e].range([R,0])}),d3.selectAll(".dimension").attr("transform",function(e){return"translate("+E(e)+")"}),d3.selectAll(".brush").each(function(e){d3.select(this).call(z[e].brush=d3.svg.brush().y(z[e]).on("brush",p))}),U++,B=B.ticks(1+M/50),d3.selectAll(".axis").each(function(e){d3.select(this).call(B.scale(z[e]))}),p()},d3.select("#keep-data").on("click",x),d3.select("#exclude-data").on("click",b),d3.select("#export-data").on("click",g),d3.select("#search").on("keyup",p),d3.select("#hide-ticks").on("click",w),d3.select("#show-ticks").on("click",$),d3.select("#dark-theme").on("click",k),d3.select("#light-theme").on("click",C)}function ModalGraph(e,t){ajax("product","OpenModalGraph").done(function(a){$("#graph .modal_container").html(a),componentHandler.upgradeDom(),e?ajax("product","SearchGraph",{id_graphics:e},"html").done(function(t){null!==t?($("#graph .modal_container").html(t),componentHandler.upgradeDom(),openObject("graph"),$("#graph #user_bt").find("a").addClass("update"),$("#graph").on("click",".update",function(){var t=$(this).closest("#graph"),a=t.data("target"),o=0,n=t.find("#name_user").val(),i=t.find("textarea").val(),s=t.find('input[type="range"]'),r={};$(".select_go label").is(":checked")&&(o=1),s.each(function(e,t){r[e]=$(t).val()}),ajax("product","UpdateGraph",{values:r,id_category:a,id_graphics:e,name_user:n,text:i,opt:o}).done(function(e){e===!0?(console.log("Your data has been saved successfully!"),closeObject("graph"),location.reload()):console.log("Something goes wrong!")})})):console.log("Something goes wrong!")}).fail(function(e){console.log("fail")}):(openObject("graph"),$("#graph").on("click",".btn_js.save",function(){var e=$(this).closest("#graph"),a=e.data("target"),o=0,n=e.find("#name_user").val(),i=e.find("textarea").val(),s=e.find('.one input[type="range"]'),r=e.find('.two input[type="range"]'),l={roz:{},opt:{}};$(".select_go label").is(":checked")&&(o=1),s.each(function(e,t){l.roz[e]=$(t).val()}),r.each(function(e,t){l.opt[e]=$(t).val()}),console.log("values"),console.log(l),ajax("product","SaveGraph",{values:l,id_category:a,name_user:n,moderation:t,text:i,opt:o}).done(function(e){e===!0?(console.log("Your data has been saved successfully!"),closeObject("graph"),location.reload()):console.log("Something goes wrong!")}).fail(function(e){console.log("fail"),console.log(e)})}))})}function ajax(e,t,a,o,n){n?(a.append("target",e),a.append("action",t)):"object"==typeof a?(a.target=e,a.action=t):a={target:e,action:t},o=o||"json";var i=$.ajax({url:URL_base+"ajax",beforeSend:function(e){ajax_proceed===!0,ajax_proceed=!0},type:"POST",dataType:o,data:a,processData:n?!1:!0,contentType:n?!1:"application/x-www-form-urlencoded; charset=UTF-8"}).always(function(){ajax_proceed=!1});return i}function resizeAsideScroll(e){var t=$(window).height(),a=$(".main").height(),o=$(".main_nav").outerHeight(),n=$(this).scrollTop(),i=n+t-a-52+o;return n+t>CurentMainWindow+52?($("aside .catalog .second_nav").css("max-height","calc(100vh - 52px - "+i+"px"),$("aside .filters_container").css("max-height","calc(100vh - 52px - "+(i+43)+"px")):($("aside .catalog .second_nav").css("max-height","calc(100vh - "+(o+52)+"px"),$("aside .filters_container").css("max-height","calc(100vh - "+(o+52+43)+"px")),!0}function ChangeView(e){switch(e){case"list":$("#view_block_js").removeClass().addClass("list_view col-md-12 ajax_loading");break;case"block":$("#view_block_js").removeClass().addClass("block_view col-md-12 ajax_loading");break;case"column":$("#view_block_js").removeClass().addClass("column_view col-md-12 ajax_loading")}ListenPhotoHover(),document.cookie="product_view="+e+"; path=/"}function ListenPhotoHover(){preview=$(".list_view .preview"),previewOwl=preview.find("#owl-product_slide_js"),$(".list_view .product_photo:not(hovered)").on("mouseover",function(){$(this).not(".hovered")&&(showPreview(!1),$(this).addClass("hovered"),rebuildPreview($(this)))}).on("mouseleave",function(e){if($("#view_block_js").hasClass("list_view")){var t=mousePos(e),a=$(this);a.hasClass("hovered")&&(t.x<=a.offset().left||t.x>=a.offset().left+a.width()||t.y<=a.offset().top||t.y>=a.offset().top+a.height())&&(hidePreview(),a.removeClass("hovered"))}}),preview.on("mouseleave",function(e){$("#view_block_js").hasClass("list_view")&&(mp=mousePos(e),obj=$(".product_photo.hovered"),obj.hasClass("hovered")&&(mp.x<=obj.offset().left||mp.x>=obj.offset().left+obj.width()||mp.y<=obj.offset().top||mp.y>=obj.offset().top+obj.height())&&(hidePreview(),obj.removeClass("hovered")))})}function hidePreview(){preview.hide().addClass("ajax_loading"),previewOwl.data("owlCarousel")&&previewOwl.data("owlCarousel").destroy()}function rebuildPreview(e){var t=e.offset(),a=$("#view_block_js").offset(),o=e.closest(".card").data("idproduct"),n=($(window).width(),$(window).height()),i=getScrollWindow(),s=0,r=0,l=15,d=l+$("header").outerHeight(),c=t.top-preview.height()/2+e.outerHeight()/2-d,u=t.top+preview.height()/2+e.outerHeight()/2+l;u>i+n?s=u-(i+n):i>c&&(r=c-i),preview.css({top:t.top-a.top-preview.height()/2+e.height()/2-s-r,left:80}),t.top-preview.offset().top+e.height()/2+preview.find(".triangle").height()>preview.height()?preview.css("border-radius","5px 5px 5px 0").find(".triangle").css({top:"50%",left:20}):preview.offset().top>t.top+e.height()/2-preview.find(".triangle").height()?preview.css("border-radius","0 5px 5px 5px").find(".triangle").css({top:"50%",left:20}):preview.css("border-radius","5px").find(".triangle").css({top:t.top-preview.offset().top+e.height()/2,left:-7}),e.hasClass("hovered")?ajax("product","GetPreview",{id_product:o},"html").done(function(e){preview.find(".preview_content").html(e),componentHandler.upgradeDom(),showPreview(!0)}):preview.hide()}function getScrollWindow(){var e=document.documentElement,t=document.body,a=e.scrollTop||t&&t.scrollTop||0;return a-=e.clientTop}function changeToTop(e){var t=$("#toTop");e>$("html").height()/8?t.hasClass("visible")===!1&&t.addClass("visible"):t.hasClass("visible")&&t.removeClass("visible")}function showPreview(e){e?preview.removeClass("ajax_loading").find("#owl-product_slide_js").owlCarousel({center:!0,dots:!0,items:1,margin:20,nav:!0,video:!0,videoHeight:300,videoWidth:300,navText:['<svg class="arrow_left"><use xlink:href="images/slider_arrows.svg#arrow_left_tidy"></use></svg>','<svg class="arrow_right"><use xlink:href="images/slider_arrows.svg#arrow_right_tidy"></use></svg>']}):preview.show()}function mousePos(e){var t=e.pageX,a=e.pageY;return{x:t,y:a}}function ChangePriceRange(e,t){var a=!1;e!=$.cookie("sum_range")&&(a=!0),1==t?($.cookie("sum_range",e,{path:"/"}),$.cookie("manual",1,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+e).addClass("active")):1!=$.cookie("manual")?($.cookie("sum_range",e,{path:"/"}),$("li.sum_range").removeClass("active"),$("li.sum_range_"+e).addClass("active"),e>0?e-=1:e=0):e=$.cookie("sum_range");var o="";addLoadAnimation(".order_balance"),ajax("cart","GetCart").done(function(t){removeLoadAnimation(".order_balance"),currentSum=t.products_sum[3],newSum=columnLimits[e]-currentSum,o=newSum<0?"Заказано достаточно!":1==$.cookie("manual")?"Дозаказать еще на "+newSum.toFixed(2).toString().replace(".",",")+" грн.":"До следующей скидки "+newSum.toFixed(2).toString().replace(".",",")+" грн.",$(".order_balance").text(o),$(".product_buy").each(function(){var e=parseInt($(this).find(".minQty").val()),t=parseInt($(this).find(".qty_js").val()),a=parseFloat($(this).find(".price"+(t>=e?"Opt":"Mopt")+$.cookie("sum_range")).val()).toFixed(2).toString().replace(".",",");t>=e?$(this).find(".priceMoptInf").addClass("hidden"):$(this).find(".priceMoptInf").removeClass("hidden"),$(this).find(".price").html(a)}),a===!0&&setTimeout(function(){$(".product_buy .product_price *").stop(!0,!0).css({color:"#FF5722"}).delay(1e3).animate({color:"#444444"},3e3)},300)})}function openObject(e,t){switch(e){case"cart":GetCartAjax(t);break;case"quiz":GetQuizAjax({reload:!1,step:3})}if(void 0===t||t.reload!==!0){var a=$("#"+e),o=a.data("type");$("html").hasClass("active_bg")&&$('.opened:not([id="'+a.attr("id")+'"])').each(function(e,t){closeObject($(this).attr("id"))}),a.hasClass("opened")&&"search"!=o?(closeObject(a.attr("id")),DeactivateBG()):("cart"==e&&addLoadAnimation("#"+e),"phone_menu"==e&&$('[data-name="phone_menu"] i').text("close"),"modal"==o?(a.find(".modal_container").css({"max-height":.8*$(window)}),Position(a.addClass("opened"))):a.addClass("opened"),ActivateBG())}}function closeObject(e){void 0===e?$(".opened").each(function(e,t){closeObject($(this).attr("id"))}):($("#"+e).removeClass("opened"),"phone_menu"==e&&$('[data-name="phone_menu"] i').text("menu")),DeactivateBG()}function Position(e){e.css({top:($(window).height()+52-e.outerHeight())/2,left:($(window).width()-e.outerWidth())/2})}function ActivateBG(){$("html").addClass("active_bg")}function DeactivateBG(){$("html").removeClass("active_bg")}function closePanel(){$(".menu").html("menu"),$(".panel").slideUp()}function changestars(e){$(".set_rating").each(function(){var t=$(this).next("i");parseInt($(this).val())<=parseInt(e)?t.text("star"):t.text("star_border")})}function GetRegions(){$.ajax({type:"post",url:URL_base+"ajax",dataType:"html",data:{target:"location",action:"GetRegionsList"}}).done(function(e){$('[for="region_select"]').html(e)})}function GetCities(e){$.ajax({type:"post",url:URL_base+"ajax",dataType:"html",data:{target:"location",action:"GetCitiesList",input:e}}).done(function(e){$('[for="city_select"]').html(e)})}function GetDeliveryService(e,t){$.ajax({type:"post",url:URL_base+"ajax",dataType:"html",data:{target:"location",action:"GetDeliveryServicesList",input:e,service:t}}).done(function(e){$(".delivery_service").html(e),componentHandler.upgradeDom()})}function GetDeliveryMethods(e,t){$.ajax({type:"post",url:URL_base+"ajax",dataType:"html",data:{target:"location",action:"GetAddressListDepartmentByCity",delivery_service:e,city:t}}).done(function(e){$(".list_post_office").html(e)})}function ValidatePass(e,t){var a,o=0,n=t.closest(".forPassStrengthContainer_js"),i=new RegExp("^(?=.*[a-zа-я]).*$","g");i.test(e)&&o++;var s=new RegExp("^(?=.*[A-ZА-Я]).*$","g");s.test(e)&&o++;var r=new RegExp("^(?=.*[0-9]).*$","g");r.test(e)&&o++;var l=new RegExp("^(?=.*[!,@,#,$,%,^,&,*,?,_,~,-,=]).*$","g");return l.test(e)&&o++,1==o&&($("#passwd + .mdl-textfield__error").empty(),n.find(".ps_lvl_js").addClass("bad").removeClass("better").removeClass("ok").removeClass("best"),a=!1),2==o&&(n.find(".ps_lvl_js").addClass("better").removeClass("ok").removeClass("best"),a=!1),3==o&&(n.find(".ps_lvl_js").addClass("ok").removeClass("best"),a=!1),4==o&&(n.find(".ps_lvl_js").addClass("best"),a=!1),e.length<1?($("#passwd + .mdl-textfield__error").empty(),n.find(".ps_lvl_js").removeClass("bad").removeClass("better").removeClass("ok").removeClass("best"),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").find(".mdl-textfield__error").text("Введите пароль")):e.length>=1&&e.length<4&&($("#passwd + .mdl-textfield__error").empty(),$('[name="new_passwd"], [name="passwd"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароль слишком короткий")),a}function ValidatePassConfirm(e,t){return t===e&&t?($('[name="passwdconfirm"]').closest(".mdl-textfield").removeClass("is-invalid").find(".mdl-textfield__error").text("Пароли совпали").css({visibility:"visible",color:"#018b06"}),$('[name="passwdconfirm"]').val().length>=4&&$(".verification_btn").removeAttr("disabled"),!1):($('[name="passwdconfirm"]').closest(".mdl-textfield").addClass("is-invalid").find(".mdl-textfield__error").text("Пароли не совпадают").css({visibility:"visible",color:"#D50000"}),void $(".verification_btn").attr("disabled","disabled"))}function ValidateEmail(e,t){ajax("auth","register",e).done(function(e){return removeLoadAnimation("#registration"),e})}function ValidateName(e){return e.length<3?($("#name ~ .mdl-textfield__error").empty(),$("#name").closest(".mdl-textfield ").addClass("is-invalid"),0===e.length?$("#name ~ .mdl-textfield__error").append("Введите имя"):$("#name ~ .mdl-textfield__error").append("Имя слишком короткое"),void 0):($("#name ~ .mdl-textfield__error").empty(),!1)}function CompleteValidation(e,t,a,o){var n=0,i=!1;return(i=ValidateName(e))&&($("#regs .mdl-textfield__error").closest("#name .mdl-textfield").text(i),n++),t&&($("#regs .mdl-textfield__error").closest("#email .mdl-textfield").text(t),n++),(i=ValidatePass(a))&&($("#regs .mdl-textfield__error").closest("#passwd .mdl-textfield").text(i),n++),(i=ValidatePassConfirm(a,o))&&($("#regs .mdl-textfield__error").closest("#passwdconfirm .mdl-textfield").text(i),n++),n>0?!1:!0}function moveObjects(){var e=$('div:not(.modals) [data-type="modal"]');e.each(function(e,t){$(".modals").append(t)});var t=$('div:not(.panels) [data-type="panel"]');t.each(function(e,t){$(".panels").append(t)})}function DelFromAssort(e){ajax("product","DelFromAssort",{id_product:e}).done(function(){$("#tr_mopt_"+e).slideUp()})}function toAssort(e,t,a,o){var n=$(".inusd"+e).prop("checked"),i=$("#currency_rate").val();1==t?mode="opt":mode="mopt";var s,r,l;s=parseFloat($("#price_"+mode+"_otpusk_"+e).val().replace(",",".")),r=parseFloat($("#price_"+mode+"_otpusk_"+e).val().replace(",",".")),n===!0&&(s*=i,r*=i),l=parseFloat($("#product_limit_mopt_"+e).val()),$("#product_limit_mopt_"+e).val(l),active=0,l>0&&(t?(po=parseFloat($("#price_opt_"+e).val()),pom=Number(po-po*parseFloat($("#price_delta_otpusk").val())*.01).toFixed(2),0!==po&&s>pom&&alert("Предлагаемая Вами крупнооптовая цена не позволяет продавать данный товар на сайте."),pop=Number(po+po*parseFloat($("#price_delta_recom").val())*.01).toFixed(2),pom=Number(po-po*parseFloat($("#price_delta_recom").val())*.01).toFixed(2),0!==po&&(r>pop||r<pom)&&alert("Предлагаемая Вами среднерыночная цена значительно отличается от цены сайта (более "+parseFloat($("#price_delta_recom").val())+"%).")):(pm=parseFloat($("#price_mopt_"+e).val()),pmm=Number(pm-pm*parseFloat($("#price_delta_otpusk").val())*.01).toFixed(2),0!==pm&&s>pmm&&alert("Предлагаемая Вами мелкооптовая цена не позволяет продавать данный товар на сайте."),pmp=Number(pm+pm*parseFloat($("#price_delta_recom").val())*.01).toFixed(2),pmm=Number(pm-pm*parseFloat($("#price_delta_recom").val())*.01).toFixed(2),0!==pm&&(r>pmp||r<pmm)&&alert("Предлагаемая Вами среднерыночная цена значительно отличается от цены сайта (более "+parseFloat($("#price_delta_recom").val())+"%).")),ao=parseFloat($("#price_opt_otpusk_"+e).val()),bo=parseFloat($("#price_opt_otpusk_"+e).val()),am=parseFloat($("#price_mopt_otpusk_"+e).val()),bm=parseFloat($("#price_mopt_otpusk_"+e).val()),active=1,ao>0&&0===bo||0===ao&&bo>0?(active=0,alert("Необходимо заполнить цены.")):(am>0&&0===bm||0===am&&bm>0)&&(active=0,alert("Необходимо заполнить цены."))),1==active?($("#tr_opt_"+e).removeClass("notavailable notprice").addClass("available"),$("#tr_mopt_"+e).removeClass("notavailable notprice").addClass("available")):($("#tr_opt_"+e).removeClass("available").addClass("notavailable"),$("#tr_mopt_"+e).removeClass("available").addClass("notavailable"),$("#product_limit_opt_"+e).val(0),$("#product_limit_mopt_"+e).val(0)),(0>=s||0>=r)&&($("#tr_opt_"+e).removeClass("available").addClass("notavailable notprice"),$("#tr_mopt_"+e).removeClass("available").addClass("notavailable notprice")),0>s&&(s=0,$("#price_opt_otpusk_"+e).val(s)),$.ajax({url:URL_base+"ajaxassort",type:"POST",cache:!1,dataType:"json",data:{action:"update_assort",opt:t,id_product:e,price_otpusk:s,price_recommend:r,nacen:a,product_limit:l,active:active,sup_comment:o,inusd:n,currency_rate:i}})}function AddDelProductAssortiment(e,t){e.checked?action="AddToAssort":action="DelFromAssort",ajax("product",action,{id_product:t})}function setCookie(e,t){var a=escape(t),o=new Date;o.setTime(o.getTime()+31536e6);var n=o.toGMTString(),i=e+"="+a+"; path=/; expires="+n;a.length<=4e3&&(document.cookie=i+";")}function getCookie(e){var t=e+"=",a=document.cookie.indexOf(t);if(-1==a)return null;var o=document.cookie.indexOf(";",a+t.length);return-1==o&&(o=document.cookie.length),unescape(document.cookie.substring(a+t.length,o))}function addLoadAnimation(e){$(e).find("div.loadBlock").length<=0&&$(e).append('<div class="loadBlock"><div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active loadAnimation"></div></div>'),componentHandler.upgradeDom()}function removeLoadAnimation(e){$(e).find("div.loadBlock").length>0&&$(e).find("div.loadBlock").remove(),componentHandler.upgradeDom()}function AddFavorite(e,t){return ajax("product","add_favorite",{id_product:e}).done(function(e){if("login"==e.answer)openObject("auth"),removeLoadAnimation("#auth");else if("already"==e.answer)var e={message:"Товар уже находится в избранном"};else if("ok"==e.answer){$(".userChoiceFav").text("("+e.fav_count+")");var e={message:"Товар добавлен в избранное"};t.empty().text("favorite").removeClass("notfavorite").addClass("isfavorite"),t.next().empty().text("Товар уже в избранном")}else if("wrong user group"==e.answer)var e={message:"Данный функционал доступен только для клиентов"};var a=document.querySelector("#demo-toast-example");a.MaterialSnackbar.showSnackbar(e)}).fail(function(e){alert("Error")}),!1}function RemoveFavorite(e,t){return ajax("product","del_favorite",{id_product:e}).done(function(e){if("login"==e.answer)openObject("auth"),removeLoadAnimation("#auth");else if("ok"==e.answer){$(".userChoiceFav").text("("+e.fav_count+")");var e={message:"Товар удален из избранного"};t.empty().text("favorite_border").addClass("notfavorite").removeClass("isfavorite"),t.next().empty().text("Добавить товар в избранное")}else if("wrong user group"==e.answer)var e={message:"Данный функционал доступен только для клиентов"};var a=document.querySelector("#demo-toast-example");a.MaterialSnackbar.showSnackbar(e)}).fail(function(e){alert("Error")}),!1}function AddInWaitingList(e,t,a,o){var n={id_product:e,id_user:t,email:a};return ajax("product","add_in_waitinglist",n).done(function(e){if("login"==e.answer)openObject("auth"),removeLoadAnimation("#auth");else if("already"==e.answer)var e={message:"Товар уже в списке ожидания"};else if("ok"==e.answer){$(".userChoiceWait").text("("+e.fav_count+")");var e={message:"Товар добавлен в список ожидания"};o.addClass("arrow"),o.closest("li").next().empty().text("Товар в списке ожидания")}else if("wrong user group"==e.answer)var e={message:"Данный функционал доступен только для клиентов"};var t=document.querySelector("#demo-toast-example");t.MaterialSnackbar.showSnackbar(e)}).fail(function(e){var e={message:"Данный функционал доступен только для клиентов"},t=document.querySelector("#demo-toast-example");t.MaterialSnackbar.showSnackbar(e)}),!1}function RemoveFromWaitingList(e,t,a,o){var n={id_product:e,id_user:t,email:a};return ajax("product","del_from_waitinglist",n).done(function(e){if("login"==e.answer)openObject("auth"),removeLoadAnimation("#auth");else if("ok"==e.answer){$(".userChoiceWait").text("("+e.fav_count+")");
var e={message:"Товар удален из списка ожидания"};o.removeClass("arrow"),o.closest("li").next().empty().text("Следить за ценой")}else if("wrong user group"==e.answer)var e={message:"Данный функционал доступен только для клиентов"};var t=document.querySelector("#demo-toast-example");t.MaterialSnackbar.showSnackbar(e)}).fail(function(e){var e={message:"Данный функционал доступен только для клиентов"},t=document.querySelector("#demo-toast-example");t.MaterialSnackbar.showSnackbar(e)}),!1}function segmentOpen(e){console.log("123"),$('[data-id="'+e+'"]').each(function(){var t=$(this).find("ul");t.length>0?console.log("есть"):(console.log("нету"),addLoadAnimation(".catalog"),ajax("segment","segmid",{idsegment:e},"html").done(function(t){$(".second_nav li").removeClass("active"),$('[data-id="'+e+'"]').append(t),$('[data-id="'+e+'"]').find(".link_wrapp").find("span").addClass("more_cat");var a=($('[data-id="'+e+'"]').find("ul").data("lvl"),$('[data-id="'+e+'"]')),o=a.hasClass("active");$('[data-id="'+e+'"]').find("ul").find("li").removeClass("active").find("ul").stop(!0,!0).slideUp(),o||a.addClass("active").find("> ul").stop(!0,!0).slideDown(),removeLoadAnimation(".catalog")}))})}function regionSelect(e){var t=e.closest("form"),a=e.val();addLoadAnimation(t),void 0!==a&&ajax("location","regionSelect",{region:a},"html").done(function(e){t.find("select:not(#region) option").remove(),t.find("#city").html(e).prop("disabled",!1),t.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)})}function citySelect(e){var t=e.closest("form"),a=e.val(),o=t.find("#region").val();addLoadAnimation(t),void 0!==a&&void 0!==o&&ajax("location","citySelect",{city:a,region:o},"html").done(function(e){t.find("select:not(#region, #city) option").remove(),t.find("#id_delivery").html(e).prop("disabled",!1),t.find("#delivery_service, #insurance, #delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)})}function deliverySelect(e){var t=e.closest("form"),a=e.val(),o=t.find("#city").val(),n=t.find("#region").val();switch(addLoadAnimation(t),a){case"1":ajax("location","deliverySelect",{city:o,region:n},"html").done(function(e){t.find("#id_delivery_service option").remove(),t.find("#id_delivery_service").html(e).prop("required",!0).prop("disabled",!1),t.find(".id_delivery_service").closest("div.mdl-cell").removeClass("hidden"),t.find(".address").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)});break;default:ajax("location","getCityId",{city:o},"html").done(function(e){t.find("#delivery_service, #insurance, #delivery_department").slideUp(),t.find("#delivery_department option").remove(),t.find("#delivery_department").append(e),t.find(".content-insurance").slideUp(),t.find(".address").closest("div.mdl-cell").removeClass("hidden"),t.find(".delivery_service").closest("div.mdl-cell").removeClass("hidden"),t.find(".delivery_department").closest("div.mdl-cell").addClass("hidden"),removeLoadAnimation(t)})}}function deliveryServiceSelect(e){var t=e.closest("form"),a=t.find("#region").val(),o=t.find("#city").val(),n=t.find("#id_delivery").val(),i=e.val(),s=e.find("option:selected").data("ref");addLoadAnimation(t),ajax("location","deliveryServiceSelect",{city:o,region:a,shipping_comp:i,ref:s,id_delivery:n},"html").done(function(e){t.find("#delivery_department option").remove(),t.find("#delivery_department").html(e).prop({required:!0,disabled:!1}),t.find(".delivery_department").closest("div.mdl-cell").removeClass("hidden"),removeLoadAnimation(t)})}function UpdateProductsList(e,t){ajax("products","getmoreproducts",t,"html").done(function(t){removeLoadAnimation(".products"),e.find(".products").html(t),componentHandler.upgradeDom(),$("img.lazy").lazyload({effect:"fadeIn"}),ListenPhotoHover(),resizeAsideScroll("show_more")})}function SortProductsList(){$(".sorting_js").find("option").each(function(e,t){$(t).text()==$(".mdl-selectfield__box span").text()&&(location.href=$(t).val())})}function init(e,t){if(canvaso=document.getElementById("err_canvas"),!canvaso)return void alert("Ошибка! Canvas элемент не найден!");if(!canvaso.getContext)return void alert("Ошибка! canvas.getContext не найден!");if(contexto=canvaso.getContext("2d"),!contexto)return void alert("Ошибка! Не могу получить getContext!");var a=canvaso.parentNode;if(canvas=document.createElement("canvas"),!canvas)return void alert("Ошибка! Не могу создать canvas элемент!");switch(canvas.id="imageTemp",canvas.width=canvaso.width,canvas.height=canvaso.height,a.appendChild(canvas),context=canvas.getContext("2d"),context.strokeStyle=e,t){case"rect":tool=new tools.rect;break;case"fillrect":tool=new tools.fillrect;break;case"pencil":tool=new tools.pencil,context.lineWidth=4;break;case"eraser":tool=new tools.eraser,context.lineWidth=20}canvas.addEventListener("mousedown",ev_canvas,!1),canvas.addEventListener("mousemove",ev_canvas,!1),canvas.addEventListener("mouseup",ev_canvas,!1)}function ev_canvas(e){e._x=e.layerX,e._y=e.layerY;var t=tool[e.type];t&&t(e)}function img_update(){contexto.drawImage(canvas,0,0),context.clearRect(0,0,canvas.width,canvas.height)}function clear_canvas(){contexto.clearRect(0,0,canvaso.width,canvaso.height),$("#canvas_mark_wrapper").find("canvas:not(#err_canvas)").remove()}var req=null,canvas,context,canvaso,contexto,tool,tool_default="line",tools={};tools.pencil=function(){var e=this;this.started=!1,this.mousedown=function(t){context.beginPath(),context.moveTo(t._x,t._y),e.started=!0},this.mousemove=function(t){e.started&&(context.lineTo(t._x,t._y),context.stroke())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.rect=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){if(e.started){var a=Math.min(t._x,e.x0),o=Math.min(t._y,e.y0),n=Math.abs(t._x-e.x0),i=Math.abs(t._y-e.y0);context.clearRect(0,0,canvas.width,canvas.height),n&&i&&(context.lineWidth=3,context.strokeRect(a,o,n,i))}},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.fillrect=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){if(e.started){var a=Math.min(t._x,e.x0),o=Math.min(t._y,e.y0),n=Math.abs(t._x-e.x0),i=Math.abs(t._y-e.y0);context.clearRect(0,0,canvas.width,canvas.height),n&&i&&context.fillRect(a,o,n,i)}},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.line=function(){var e=this;this.started=!1,this.mousedown=function(t){e.started=!0,e.x0=t._x,e.y0=t._y},this.mousemove=function(t){e.started&&(context.clearRect(0,0,canvas.width,canvas.height),context.beginPath(),context.moveTo(e.x0,e.y0),context.lineTo(t._x,t._y),context.stroke(),context.closePath())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}},tools.eraser=function(){var e=this;this.started=!1,this.mousedown=function(t){context.beginPath(),context.moveTo(t._x,t._y),e.started=!0},this.mousemove=function(t){e.started&&(context.lineTo(t._x,t._y),context.stroke())},this.mouseup=function(t){e.started&&(e.mousemove(t),e.started=!1,img_update())}};
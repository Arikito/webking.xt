<?php$Products = new Products();$dbtree = new dbtree(_DB_PREFIX_.'category', 'category', $db);if(isset($_GET['savedprices']) == true){	$price_list = $Products->GetPricelistById($_GET['selected-array']);	foreach($price_list as $l){		if($l['img_1'] == ''){			$images = $Products->GetPhotoById($l['id_product']);			$image = $images[0]['src'];		}else{			$image = $l['img_1'];		}		$name = $l['price_name'];		$list1[$l['id_category']]['name'] = $l['cat_name'];		$list1[$l['id_category']]['products'][] = array(			'id_product' => $l['id_product'],			'art' => $l['art'],			'img_1' => $image,			'name' => $l['name'],			'min_mopt_qty' => $l['min_mopt_qty'],			'inbox_qty' => $l['inbox_qty'],			'price_mopt' => $l['price_mopt'],			'price_opt' => $l['price_opt'],			'units' => $l['units'],			'opt_correction_set' => $l['opt_correction_set'],			'mopt_correction_set' => $l['mopt_correction_set']		);	}	$fields = array('id_category', 'name', 'pid', 'category_level');	$var1 = $dbtree->GetCats($fields, 1);	$var2 = $dbtree->GetCats($fields, 2);	foreach($var1 as $v1){		$list[$v1['id_category']] = $v1;		foreach($var2 as $v2){			if(isset($list1[$v2['id_category']])){				$v2['products'] = $list1[$v2['id_category']]['products'];			}			$var3 = $dbtree->GetSubCats($v2['id_category'], $fields);			foreach($var3 as $v3){				if(isset($list1[$v3['id_category']])){					$v3['products'] = $list1[$v3['id_category']]['products'];					$v2['subcats'][$v3['id_category']] = $v3;				}			}			if(isset($v2['subcats']) == true || isset($v2['products']) == true){				$list[$v2['pid']]['subcats'][$v2['id_category']] = $v2;			}		}	}	$tpl->Assign('name', $name);}else{	$selected_list = explode(';', $_GET['selected-array']);	array_pop($selected_list);	foreach($selected_list as $sl){		$list[$sl] = $Products->PriceListProductsByCat($sl);		$cat[] = $dbtree->CheckParent($sl);	}	$tpl->Assign('cat', $cat);}$tpl->Assign('list', $list);echo $tpl->Parse($GLOBALS['PATH_tpl'].'price_list.tpl');exit(0);?>
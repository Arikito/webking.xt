<h1><?=$header?></h1><div id="edit_modprodae" class="grid">	<div class="row">		<form class="col-md-6" action="<?=$_SERVER['REQUEST_URI']?>" id="editbox" method="post">			<input type="hidden" name="id" value="<?=$_POST['id'];?>">			<input type="hidden" name="supplier_email" value="<?=$_POST['supplier_email'];?>">			<label for="product_name" class="name">Название:</label>			<input type="text" name="name" id="product_name" class="input-m" maxlength="255" autocomplete="off" required value="<?=isset($_POST['name'])? htmlspecialchars($_POST['name']):null;?>">			<label for="descr" class="descr">Описание:</label>			<textarea name="descr" id="descr" class="input-m" rows="8" required><?=isset($_POST['descr'])? str_replace('<br>', '', $_POST['descr']):null;?></textarea>			<label>Изображения товара на x-tog.com:</label>			<div class="row" id="preview1">				<div class="col-md-2"><img class="pic_block" id="i1" src="<?=G::GetImageUrl($_POST['img_1'], 'thumb')?>"></div>				<div class="col-md-10"><input type="text" id="img_1" name="img_1" class="input-m" value="<?=isset($_POST['img_1'])?htmlspecialchars($_POST['img_1']):null?>"></div>			</div>			<div class="row" id="preview2">				<div class="col-md-2"><img class="pic_block" id="i2" src="<?=G::GetImageUrl($_POST['img_2'], 'thumb')?>"></div>				<div class="col-md-10"><input type="text" id="img_2" name="img_2" class="input-m" value="<?=isset($_POST['img_2'])?htmlspecialchars($_POST['img_2']):null?>"></div>			</div>			<div class="row" id="preview3">				<div class="col-md-2"><img class="pic_block" id="i3" src="<?=G::GetImageUrl($_POST['img_3'], 'thumb')?>"></div>				<div class="col-md-10"><input type="text" id="img_3" name="img_3" class="input-m" value="<?=isset($_POST['img_3'])?htmlspecialchars($_POST['img_3']):null?>"></div>			</div>			<label>Изображения товара на xt.ua:</label>			<div id="photobox">				<?if(isset($_POST['images']) && $_POST['images'] != ''){					$arr = explode(';', $_POST['images']);?>					<input type="hidden" name="images" value="<?=$_POST['images']?>">				<?}else{?>					<input type="hidden" name="images">				<?}?>				<div class="previews">					<?if(!empty($arr)){						foreach($arr AS $photo){?>							<div class="image_block dz-preview dz-processing dz-success dz-complete dz-image-preview">								<div class="sort_handle"><span class="icon-font">s</span></div>								<div class="image">									<img data-dz-thumbnail src="<?=$photo?>"/>								</div>								<div class="name">									<span class="dz-filename" data-dz-name><?=str_replace('/files/'.$_SESSION['member']['email'].'/','',$photo)?></span>									<span class="dz-size" data-dz-size></span>								</div>								<div class="controls">									<p class="del_photo_js"><span class="icon-font">t</span></p>								</div>								<input type="hidden" class="photo_src" value="<?=$photo?>">							</div>						<?}					}?>				</div>				<div class="image_block_new drop_zone animate">					<div class="dz-default dz-message">Перетащите сюда фото или нажмите для загрузки.</div>					<input type="file" multiple="multiple" class="dz-hidden-input" style="visibility: hidden; position: absolute; top: 0px; left: 0px; height: 0px; width: 0px;">				</div>			</div>			<label for="id_unit" class="units">Еденицы измерения:</label>			<select class="input-m" name="id_unit" id="id_unit">				<?foreach($units as $value){?>					<option value="<?=$value['id']?>" <?=isset($_POST['id_unit'])&&$_POST['id_unit']==$value['id']?'selected="true"':null?>><?=$value['unit_xt']?></option>				<?}?>			</select>			<label for="min_mopt_qty">Минимально отпускаемое количество товара:</label>			<input class="input-m wa" type="text" id="min_mopt_qty" name="min_mopt_qty" required value="<?=isset($_POST['min_mopt_qty'])? $_POST['min_mopt_qty']:null;?>"> <span></span>			<label for="qty_control" class="qty_control">Кратность минимального количества:				<input type="checkbox" name="qty_control" id="qty_control" class="input-m" value="1" <?=(isset($_POST['qty_control']) && $_POST['qty_control'] == 1)?'checked="true"':null;?>>			</label>			<label for="inbox_qty">Оптовое количество товара:</label>			<input type="text" id="inbox_qty" class="input-m wa" name="inbox_qty" required value="<?=isset($_POST['inbox_qty'])? $_POST['inbox_qty']:null;?>"> <span></span>			<label for="price_mopt">Цена за единицу товара при минимальном количестве:</label>			<input type="text" id="price_mopt" class="input-m wa" name="price_mopt" required value="<?=isset($_POST['price_mopt'])? $_POST['price_mopt']:null;?>"><span> грн</span>			<label for="price_opt">Оптовая цена:</label>			<input type="text" id="price_opt" class="input-m wa" name="price_opt" required value="<?=isset($_POST['price_opt'])? $_POST['price_opt']:null;?>"><span> грн</span>			<label for="weight" class="weight">Вес:</label>			<input type="text" name="weight" id="weight" class="input-m wa" value="<?=isset($_POST['weight'])? $_POST['weight']:null;?>"><span> кг</span>			<label for="volume" class="volume">Объем:</label>			<input type="text" name="volume" id="volume" class="input-m wa" value="<?=isset($_POST['volume'])? $_POST['volume']:null;?>"><span> м&#179;</span>			<label for="volume">Габариты:</label>			<div class="fl dimensions">				<label for="height">Высота (cм):</label>				<input type="number" name="height" id="height" class="input-m" min="0" value="<?=isset($_POST['height'])?htmlspecialchars($_POST['height']):0?>" required>			</div>			<div class="fl dimensions">				<label for="width">Ширина (см):</label>				<input type="number" name="width" id="width" class="input-m" min="0" value="<?=isset($_POST['width'])?htmlspecialchars($_POST['width']):0?>" required>			</div>			<div class="fl dimensions">				<label for="length">Длина (см):</label>				<input type="number" name="length" id="length" class="input-m" min="0" value="<?=isset($_POST['length'])?htmlspecialchars($_POST['length']):0?>" required>			</div>			<label class="volume">Объем:				<span>					<?if(isset($_POST['volume']) ){						if($_POST['volume'] == 0){?>							Заполните поля (ВхШхД)						<?}else{							echo $_POST['volume'].' м3';						}					}else{?>						-					<?}?>				</span>			</label>			<label for="coefficient_volume">Коэффициент реального обьема:</label>			<input type="number" name="coefficient_volume" id="coefficient_volume" class="input-m" min="0" step="0.01" value="<?=isset($_POST['coefficient_volume'])?$_POST['coefficient_volume']:1;?>">			<label for="product_limit" class="product_limit">Актуальный остаток:</label>			<input type="text" name="product_limit" id="product_limit" class="input-m wa" required value="<?=isset($_POST['product_limit'])? $_POST['product_limit']:null;?>"> <span></span>			<div class="clear"></div>			<button type="submit" id="submit" class="btn-l-default save-btn" name="smb">Сохранить</button>		</form>		<div id="preview-template" style="display: none;">			<div class="image_block dz-preview dz-file-preview">				<div class="sort_handle"><span class="icon-font">s</span></div>				<div class="image">					<img data-dz-thumbnail />				</div>				<div class="name">					<span class="dz-filename" data-dz-name></span>					<span class="dz-size" data-dz-size></span>				</div>				<div class="controls">					<p class="del_photo_js"><span class="icon-font">t</span></p>				</div>			</div>		</div>	</div></div><script>	<?if(isset($_POST['moderation_status']) == true && $_POST['moderation_status'] == 2){?>		$('#editbox input,#editbox select, #editbox textarea').prop('disabled', true);	<?}?>	var url = "<?=$_SERVER['REQUEST_URI']?>";	$(function(){		//Пересчет обьема при вводе		$("#height, #width, #length").keyup(function( event ) {			var height = $("#height").val(),				width = $("#width").val(),				length = $("#length").val(),				volume = 0;			volume = height * width * length;			$(".volume span").html(((volume*0.000001).toFixed(6))+" м3");		});		$('#photobox').removeClass('ajax_loading');		//Удаление фото		$('body').on('click', '.del_photo_js', function(event) {			event.preventDefault();			if(confirm('Изобрежение будет удалено.')){				var path = $(this).closest('.image_block'),					removed_file = path.find('.photo_src').val(),					images = $('#photobox').find('input[name="images"]').val().split(';'),					index = images.indexOf(removed_file);				images.splice(index, 1);				$('#photobox').find('input[name="images"]').val(images.join(';'));				path.closest('.previews').append('<input type="hidden" name="removed_images[]" value="'+removed_file+'">');				$(this).closest('.image_block').remove();			}		});		var dropzone = new Dropzone(".drop_zone", {			method: 'POST',			url: url+"/?upload=true",			clickable: true,			previewsContainer: '.previews',			previewTemplate: document.querySelector('#preview-template').innerHTML		});		dropzone.on('success', function(file, path){			file.previewElement.innerHTML += '<input type="hidden" class="photo_src" value="'+path+'">';			var images = $('#photobox').find('input[name="images"]').val();			if(images == ''){				$('#photobox').find('input[name="images"]').val(path);			}else{				$('#photobox').find('input[name="images"]').val(images+';'+path);			}		});		$('.previews').sortable({			items: ".image_block",			handle: ".sort_handle",			connectWith: ".previews",			containment: ".previews",			placeholder: "ui-sortable-placeholder",			axis: "y",			scroll: false,			tolerance: "pointer",			update: function(event, ui){				var images = '';				$('.previews img').each(function(){					if(images == ''){						images = $(this).closest('.image_block').find('.photo_src').attr('value');					}else{						images += ';'+$(this).closest('.image_block').find('.photo_src').attr('value');					}				});				$('#photobox').find('input[name="images"]').val(images);			}		});	});	// function removeimage(name){	// 	$.ajax({	// 		url: url+"?remove=true",	// 		type: 'POST',	// 		data: {	// 			image: name,	// 		}	// 	}).done(function(data){	// 		var images = $('#photobox').find('input[name="images"]').val().split(';');	// 		var index = images.indexOf(data);	// 		images.splice(index, 1);	// 		$('#photobox').find('input[name="images"]').val(images.join(';'));	// 	});	// }	showUnits();	$('[id^="img_"]').on('change', function(){		validatePhoto();	});	$('#product_name').blur(function(){		validateName();	});	$('#id_unit').change(function(){		showUnits();	});	$('#min_mopt_qty, #inbox_qty').blur(function(){		validateMinMoptQty();		validateInboxQty();	});	$('#price_mopt, #price_opt').blur(function(){		validateOptPrice();	});	$('#product_limit').blur(function(){		validateProductLimit();	});	function validateName(){		if($('#product_name').val() == ''){			registerError('product_name','+','Имя не указано');		}else{			registerError('product_name','-');		}	}	function validateUnits(){		if($('#units').val().match('[0-9]')){			registerError('units','+','Это значение не может содержать числа');		}else if($('#units').val() == ''){			registerError('units','+','Не указаны еденицы измерения');		}else{			registerError('units','-');		}	}	function validateMinMoptQty(){		if(parseInt($('#min_mopt_qty').val()) <= 0 || $('#min_mopt_qty').val() == ''){			registerError('min_mopt_qty','+','Не указано минимальное количество');		}else{			registerError('min_mopt_qty','-');		}		if(parseInt($('#min_mopt_qty').val()) == 1){			$('#qty_control').prop('disabled', true).prop('checked', false);		}else{			$('#qty_control').prop('disabled', false);		}	}	function validateInboxQty(){		if(parseInt($('#inbox_qty').val()) <= 0 || $('#inbox_qty').val() == ''){			registerError('inbox_qty','+','Не указано количество в ящике');		}else if(parseInt($('#inbox_qty').val()) <= parseInt($('#min_mopt_qty').val())){			registerError('inbox_qty','+','Количество в ящике должно быть больше минимального количества');		}else{			registerError('inbox_qty','-');		}	}	function validateMoptPrice(){		if(parseFloat($('#price_mopt').val()) <= 0 || $('#price_mopt').val() == ''){			registerError('price_mopt','+','Не указана розничная цена');		}else{			registerError('price_mopt','-');		}	}	function validateOptPrice(){		if(parseFloat($('#price_opt').val()) <= 0 || $('#price_opt').val() == ''){			registerError('price_opt','+','Не указана оптовая цена');		}else if(parseFloat($('#price_opt').val()) > parseFloat($('#price_mopt').val()) && parseFloat($('#price_mopt').val()) > 0){			registerError('price_opt','+','Оптовая цена не может превышать розничную');		}else{			registerError('price_opt','-');		}	}	function validateProductLimit(){		if(parseInt($('#product_limit').val()) <= 0 || $('#product_limit').val() == ''){			registerError('product_limit','+','Товар должен быть в наличии');		}else{			registerError('product_limit','-');		}	}	function showUnits(){		$('#min_mopt_qty + span, #inbox_qty + span, #product_limit + span').hide().html($('#id_unit option:selected').text()).fadeIn();	}	function registerError(key, direction, content){		if(direction == "+"){			errors[key] = content;			$('#'+key).css('color', '#f33').closest('.row').find('p.error').remove();			$('#'+key).closest('.row').append('<p class="error" style="display: block; width: 60%;font-weight: normal; float: right; color: #f00;clear: both;">'+content+'</p>');		}else if(direction == "-"){			delete errors[key];			$('#'+key).css('color', '#000').closest('.row').find('p.error').remove();		}		if(count(errors) > 0){			$('#submit').prop('disabled', true);		}else{			$('#submit').prop('disabled', false);		}	}	$('#submit').on('click', function(){		$('.photo_upload_area').each(function(){			if($(this).find('#photo_preview').html() == '' && $(this).find('[id^="img_"]').val().length > 0){				deletePhoto($(this).prop('class').replace(/\D+/g,""), $(this).find('[id^="img_"]').val());				$(this).find('[id^="img_"]').val('');			}		});		if(validateForm() == true){			$(this).closest('form').submit();		}else{			return false;		}	});	function validateForm(){		validateName();		validatePhoto();		validateUnits();		validateMinMoptQty();		validateInboxQty();		validateMoptPrice();		validateOptPrice();		validateProductLimit();		if($('#submit').prop('disabled') == true){			return false;		}else{			return true;		}	}</script>